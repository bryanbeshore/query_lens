  [1m[35m (0.1ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" varchar NOT NULL PRIMARY KEY)[0m
  [1m[35m (0.0ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" varchar NOT NULL PRIMARY KEY, "value" varchar, "created_at" datetime(6) NOT NULL, "updated_at" datetime(6) NOT NULL)[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[36mBEGIN deferred TRANSACTION[0m
-----------------------------------------------------------------------------
QueryLens::SqlGeneratorTest: test_raises_error_when_API_key_is_not_configured
-----------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[31mROLLBACK TRANSACTION[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[36mBEGIN deferred TRANSACTION[0m
---------------------------------------------------------------
QueryLens::SqlGeneratorTest: test_extracts_SQL_from_code_fences
---------------------------------------------------------------
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[31mROLLBACK TRANSACTION[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[36mBEGIN deferred TRANSACTION[0m
---------------------------------------------------------------------------------
QueryLens::SqlGeneratorTest: test_returns_nil_sql_when_no_code_fences_in_response
---------------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[31mROLLBACK TRANSACTION[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[36mBEGIN deferred TRANSACTION[0m
------------------------------------------------------------------------
QueryLens::SqlGeneratorTest: test_generates_SQL_from_Claude_API_response
------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[31mROLLBACK TRANSACTION[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[36mBEGIN deferred TRANSACTION[0m
---------------------------------------------------------------------------
QueryLens::SchemaIntrospectorTest: test_introspects_all_non-excluded_tables
---------------------------------------------------------------------------
  [1m[35m (0.0ms)[0m  [1m[35mDROP TABLE IF EXISTS "users"[0m
  [1m[35m (0.1ms)[0m  [1m[35mCREATE TABLE "users" ("id" integer PRIMARY KEY AUTOINCREMENT NOT NULL, "name" varchar, "email" varchar, "created_at" datetime(6) NOT NULL, "updated_at" datetime(6) NOT NULL)[0m
  [1m[35m (0.0ms)[0m  [1m[35mDROP TABLE IF EXISTS "accounts"[0m
  [1m[35m (0.0ms)[0m  [1m[35mCREATE TABLE "accounts" ("id" integer PRIMARY KEY AUTOINCREMENT NOT NULL, "name" varchar, "plan" varchar, "created_at" datetime(6) NOT NULL, "updated_at" datetime(6) NOT NULL)[0m
  [1m[35m (0.0ms)[0m  [1m[35mDROP TABLE IF EXISTS "transactions"[0m
  [1m[35m (0.0ms)[0m  [1m[35mCREATE TABLE "transactions" ("id" integer PRIMARY KEY AUTOINCREMENT NOT NULL, "account_id" integer, "user_id" integer, "amount" decimal(10,2), "description" varchar, "created_at" datetime(6) NOT NULL, "updated_at" datetime(6) NOT NULL)[0m
  [1m[35m (0.0ms)[0m  [1m[35mCREATE INDEX "index_transactions_on_account_id" ON "transactions" ("account_id")[0m
  [1m[35m (0.0ms)[0m  [1m[35mCREATE INDEX "index_transactions_on_user_id" ON "transactions" ("user_id")[0m
  [1m[35m (0.0ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" varchar NOT NULL PRIMARY KEY)[0m
  [1m[35m (0.0ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" varchar NOT NULL PRIMARY KEY, "value" varchar, "created_at" datetime(6) NOT NULL, "updated_at" datetime(6) NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::InternalMetadata Create (0.0ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES ('environment', 'test', '2026-02-07 18:17:04.012975', '2026-02-07 18:17:04.012977') RETURNING "key"[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "accounts"[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "transactions"[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[31mROLLBACK TRANSACTION[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[36mBEGIN deferred TRANSACTION[0m
-----------------------------------------------------------------------
QueryLens::SchemaIntrospectorTest: test_includes_approximate_row_counts
-----------------------------------------------------------------------
  [1m[35m (0.0ms)[0m  [1m[35mDROP TABLE IF EXISTS "users"[0m
  [1m[35m (0.1ms)[0m  [1m[35mCREATE TABLE "users" ("id" integer PRIMARY KEY AUTOINCREMENT NOT NULL, "name" varchar, "email" varchar, "created_at" datetime(6) NOT NULL, "updated_at" datetime(6) NOT NULL)[0m
  [1m[35m (0.0ms)[0m  [1m[35mDROP TABLE IF EXISTS "accounts"[0m
  [1m[35m (0.0ms)[0m  [1m[35mCREATE TABLE "accounts" ("id" integer PRIMARY KEY AUTOINCREMENT NOT NULL, "name" varchar, "plan" varchar, "created_at" datetime(6) NOT NULL, "updated_at" datetime(6) NOT NULL)[0m
  [1m[35m (0.0ms)[0m  [1m[35mDROP TABLE IF EXISTS "transactions"[0m
  [1m[35m (0.0ms)[0m  [1m[35mCREATE TABLE "transactions" ("id" integer PRIMARY KEY AUTOINCREMENT NOT NULL, "account_id" integer, "user_id" integer, "amount" decimal(10,2), "description" varchar, "created_at" datetime(6) NOT NULL, "updated_at" datetime(6) NOT NULL)[0m
  [1m[35m (0.0ms)[0m  [1m[35mCREATE INDEX "index_transactions_on_account_id" ON "transactions" ("account_id")[0m
  [1m[35m (0.0ms)[0m  [1m[35mCREATE INDEX "index_transactions_on_user_id" ON "transactions" ("user_id")[0m
  [1m[35m (0.0ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" varchar NOT NULL PRIMARY KEY)[0m
  [1m[35m (0.0ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" varchar NOT NULL PRIMARY KEY, "value" varchar, "created_at" datetime(6) NOT NULL, "updated_at" datetime(6) NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.0ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::InternalMetadata Create (0.0ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES ('environment', 'test', '2026-02-07 18:17:04.019578', '2026-02-07 18:17:04.019579') RETURNING "key"[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "accounts"[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "transactions"[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[31mROLLBACK TRANSACTION[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[36mBEGIN deferred TRANSACTION[0m
------------------------------------------------------------------------------
QueryLens::SchemaIntrospectorTest: test_respects_excluded_tables_configuration
------------------------------------------------------------------------------
  [1m[35m (0.0ms)[0m  [1m[35mDROP TABLE IF EXISTS "users"[0m
  [1m[35m (0.0ms)[0m  [1m[35mCREATE TABLE "users" ("id" integer PRIMARY KEY AUTOINCREMENT NOT NULL, "name" varchar, "email" varchar, "created_at" datetime(6) NOT NULL, "updated_at" datetime(6) NOT NULL)[0m
  [1m[35m (0.0ms)[0m  [1m[35mDROP TABLE IF EXISTS "accounts"[0m
  [1m[35m (0.0ms)[0m  [1m[35mCREATE TABLE "accounts" ("id" integer PRIMARY KEY AUTOINCREMENT NOT NULL, "name" varchar, "plan" varchar, "created_at" datetime(6) NOT NULL, "updated_at" datetime(6) NOT NULL)[0m
  [1m[35m (0.0ms)[0m  [1m[35mDROP TABLE IF EXISTS "transactions"[0m
  [1m[35m (0.0ms)[0m  [1m[35mCREATE TABLE "transactions" ("id" integer PRIMARY KEY AUTOINCREMENT NOT NULL, "account_id" integer, "user_id" integer, "amount" decimal(10,2), "description" varchar, "created_at" datetime(6) NOT NULL, "updated_at" datetime(6) NOT NULL)[0m
  [1m[35m (0.0ms)[0m  [1m[35mCREATE INDEX "index_transactions_on_account_id" ON "transactions" ("account_id")[0m
  [1m[35m (0.0ms)[0m  [1m[35mCREATE INDEX "index_transactions_on_user_id" ON "transactions" ("user_id")[0m
  [1m[35m (0.0ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" varchar NOT NULL PRIMARY KEY)[0m
  [1m[35m (0.0ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" varchar NOT NULL PRIMARY KEY, "value" varchar, "created_at" datetime(6) NOT NULL, "updated_at" datetime(6) NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.0ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::InternalMetadata Create (0.0ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES ('environment', 'test', '2026-02-07 18:17:04.023577', '2026-02-07 18:17:04.023578') RETURNING "key"[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "accounts"[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[31mROLLBACK TRANSACTION[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[36mBEGIN deferred TRANSACTION[0m
-------------------------------------------------------------
QueryLens::SchemaIntrospectorTest: test_generates_prompt_text
-------------------------------------------------------------
  [1m[35m (0.0ms)[0m  [1m[35mDROP TABLE IF EXISTS "users"[0m
  [1m[35m (0.0ms)[0m  [1m[35mCREATE TABLE "users" ("id" integer PRIMARY KEY AUTOINCREMENT NOT NULL, "name" varchar, "email" varchar, "created_at" datetime(6) NOT NULL, "updated_at" datetime(6) NOT NULL)[0m
  [1m[35m (0.0ms)[0m  [1m[35mDROP TABLE IF EXISTS "accounts"[0m
  [1m[35m (0.0ms)[0m  [1m[35mCREATE TABLE "accounts" ("id" integer PRIMARY KEY AUTOINCREMENT NOT NULL, "name" varchar, "plan" varchar, "created_at" datetime(6) NOT NULL, "updated_at" datetime(6) NOT NULL)[0m
  [1m[35m (0.0ms)[0m  [1m[35mDROP TABLE IF EXISTS "transactions"[0m
  [1m[35m (0.0ms)[0m  [1m[35mCREATE TABLE "transactions" ("id" integer PRIMARY KEY AUTOINCREMENT NOT NULL, "account_id" integer, "user_id" integer, "amount" decimal(10,2), "description" varchar, "created_at" datetime(6) NOT NULL, "updated_at" datetime(6) NOT NULL)[0m
  [1m[35m (0.0ms)[0m  [1m[35mCREATE INDEX "index_transactions_on_account_id" ON "transactions" ("account_id")[0m
  [1m[35m (0.0ms)[0m  [1m[35mCREATE INDEX "index_transactions_on_user_id" ON "transactions" ("user_id")[0m
  [1m[35m (0.0ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" varchar NOT NULL PRIMARY KEY)[0m
  [1m[35m (0.0ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" varchar NOT NULL PRIMARY KEY, "value" varchar, "created_at" datetime(6) NOT NULL, "updated_at" datetime(6) NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.0ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::InternalMetadata Create (0.0ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES ('environment', 'test', '2026-02-07 18:17:04.026788', '2026-02-07 18:17:04.026789') RETURNING "key"[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "accounts"[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "transactions"[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[31mROLLBACK TRANSACTION[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[36mBEGIN deferred TRANSACTION[0m
----------------------------------------------------------------------
QueryLens::SchemaIntrospectorTest: test_introspects_columns_with_types
----------------------------------------------------------------------
  [1m[35m (0.0ms)[0m  [1m[35mDROP TABLE IF EXISTS "users"[0m
  [1m[35m (0.1ms)[0m  [1m[35mCREATE TABLE "users" ("id" integer PRIMARY KEY AUTOINCREMENT NOT NULL, "name" varchar, "email" varchar, "created_at" datetime(6) NOT NULL, "updated_at" datetime(6) NOT NULL)[0m
  [1m[35m (0.0ms)[0m  [1m[35mDROP TABLE IF EXISTS "accounts"[0m
  [1m[35m (0.0ms)[0m  [1m[35mCREATE TABLE "accounts" ("id" integer PRIMARY KEY AUTOINCREMENT NOT NULL, "name" varchar, "plan" varchar, "created_at" datetime(6) NOT NULL, "updated_at" datetime(6) NOT NULL)[0m
  [1m[35m (0.0ms)[0m  [1m[35mDROP TABLE IF EXISTS "transactions"[0m
  [1m[35m (0.0ms)[0m  [1m[35mCREATE TABLE "transactions" ("id" integer PRIMARY KEY AUTOINCREMENT NOT NULL, "account_id" integer, "user_id" integer, "amount" decimal(10,2), "description" varchar, "created_at" datetime(6) NOT NULL, "updated_at" datetime(6) NOT NULL)[0m
  [1m[35m (0.0ms)[0m  [1m[35mCREATE INDEX "index_transactions_on_account_id" ON "transactions" ("account_id")[0m
  [1m[35m (0.0ms)[0m  [1m[35mCREATE INDEX "index_transactions_on_user_id" ON "transactions" ("user_id")[0m
  [1m[35m (0.0ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" varchar NOT NULL PRIMARY KEY)[0m
  [1m[35m (0.0ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" varchar NOT NULL PRIMARY KEY, "value" varchar, "created_at" datetime(6) NOT NULL, "updated_at" datetime(6) NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.0ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::InternalMetadata Create (0.0ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES ('environment', 'test', '2026-02-07 18:17:04.031396', '2026-02-07 18:17:04.031397') RETURNING "key"[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "accounts"[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "transactions"[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[31mROLLBACK TRANSACTION[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[36mBEGIN deferred TRANSACTION[0m
--------------------------------------------------------------------------------
QueryLens::SchemaIntrospectorTest: test_identifies_foreign_keys_from__id_columns
--------------------------------------------------------------------------------
  [1m[35m (0.0ms)[0m  [1m[35mDROP TABLE IF EXISTS "users"[0m
  [1m[35m (0.1ms)[0m  [1m[35mCREATE TABLE "users" ("id" integer PRIMARY KEY AUTOINCREMENT NOT NULL, "name" varchar, "email" varchar, "created_at" datetime(6) NOT NULL, "updated_at" datetime(6) NOT NULL)[0m
  [1m[35m (0.0ms)[0m  [1m[35mDROP TABLE IF EXISTS "accounts"[0m
  [1m[35m (0.0ms)[0m  [1m[35mCREATE TABLE "accounts" ("id" integer PRIMARY KEY AUTOINCREMENT NOT NULL, "name" varchar, "plan" varchar, "created_at" datetime(6) NOT NULL, "updated_at" datetime(6) NOT NULL)[0m
  [1m[35m (0.0ms)[0m  [1m[35mDROP TABLE IF EXISTS "transactions"[0m
  [1m[35m (0.0ms)[0m  [1m[35mCREATE TABLE "transactions" ("id" integer PRIMARY KEY AUTOINCREMENT NOT NULL, "account_id" integer, "user_id" integer, "amount" decimal(10,2), "description" varchar, "created_at" datetime(6) NOT NULL, "updated_at" datetime(6) NOT NULL)[0m
  [1m[35m (0.0ms)[0m  [1m[35mCREATE INDEX "index_transactions_on_account_id" ON "transactions" ("account_id")[0m
  [1m[35m (0.0ms)[0m  [1m[35mCREATE INDEX "index_transactions_on_user_id" ON "transactions" ("user_id")[0m
  [1m[35m (0.0ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" varchar NOT NULL PRIMARY KEY)[0m
  [1m[35m (0.0ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" varchar NOT NULL PRIMARY KEY, "value" varchar, "created_at" datetime(6) NOT NULL, "updated_at" datetime(6) NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.0ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::InternalMetadata Create (0.0ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES ('environment', 'test', '2026-02-07 18:17:04.035692', '2026-02-07 18:17:04.035693') RETURNING "key"[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "accounts"[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "transactions"[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[31mROLLBACK TRANSACTION[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[36mBEGIN deferred TRANSACTION[0m
------------------------------------------------------------------
QueryLens::QueriesControllerTest: test_execute_runs_SELECT_queries
------------------------------------------------------------------
  [1m[35m (0.0ms)[0m  [1m[35mDROP TABLE IF EXISTS "users"[0m
  [1m[35m (0.1ms)[0m  [1m[35mCREATE TABLE "users" ("id" integer PRIMARY KEY AUTOINCREMENT NOT NULL, "name" varchar, "email" varchar, "created_at" datetime(6) NOT NULL, "updated_at" datetime(6) NOT NULL)[0m
  [1m[35m (0.0ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" varchar NOT NULL PRIMARY KEY)[0m
  [1m[35m (0.0ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" varchar NOT NULL PRIMARY KEY, "value" varchar, "created_at" datetime(6) NOT NULL, "updated_at" datetime(6) NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.0ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::InternalMetadata Create (0.0ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES ('environment', 'test', '2026-02-07 18:17:04.040061', '2026-02-07 18:17:04.040063') RETURNING "key"[0m
  [1m[35m (0.1ms)[0m  [1m[32mINSERT INTO users (name, email, created_at, updated_at) VALUES ('Alice', 'alice@example.com', datetime('now'), datetime('now'))[0m
  [1m[35m (0.0ms)[0m  [1m[32mINSERT INTO users (name, email, created_at, updated_at) VALUES ('Bob', 'bob@example.com', datetime('now'), datetime('now'))[0m
Started POST "/query_lens/execute" for 127.0.0.1 at 2026-02-07 13:17:04 -0500
Processing by QueryLens::QueriesController#execute as JSON
  Parameters: {"sql" => "SELECT name, email FROM users ORDER BY name", "query" => {"sql" => "SELECT name, email FROM users ORDER BY name"}}
Can't verify CSRF token authenticity.
Completed 422 Unprocessable Content in 0ms (ActiveRecord: 0.0ms (0 queries, 0 cached) | GC: 0.0ms)
  
ActionController::InvalidAuthenticityToken (Can't verify CSRF token authenticity.):
  
actionpack (8.1.2) lib/action_controller/metal/request_forgery_protection.rb:321:in 'ActionController::RequestForgeryProtection::ProtectionMethods::Exception#handle_unverified_request'
actionpack (8.1.2) lib/action_controller/metal/request_forgery_protection.rb:415:in 'ActionController::RequestForgeryProtection#handle_unverified_request'
actionpack (8.1.2) lib/action_controller/metal/request_forgery_protection.rb:404:in 'ActionController::RequestForgeryProtection#verify_authenticity_token'
activesupport (8.1.2) lib/active_support/callbacks.rb:362:in 'block in ActiveSupport::Callbacks::CallTemplate::MethodCall#make_lambda'
activesupport (8.1.2) lib/active_support/callbacks.rb:179:in 'block in ActiveSupport::Callbacks::Filters::Before#call'
actionpack (8.1.2) lib/abstract_controller/callbacks.rb:36:in 'block (2 levels) in <module:Callbacks>'
activesupport (8.1.2) lib/active_support/callbacks.rb:180:in 'ActiveSupport::Callbacks::Filters::Before#call'
activesupport (8.1.2) lib/active_support/callbacks.rb:560:in 'block in ActiveSupport::Callbacks::CallbackSequence#invoke_before'
activesupport (8.1.2) lib/active_support/callbacks.rb:560:in 'Array#each'
activesupport (8.1.2) lib/active_support/callbacks.rb:560:in 'ActiveSupport::Callbacks::CallbackSequence#invoke_before'
activesupport (8.1.2) lib/active_support/callbacks.rb:109:in 'ActiveSupport::Callbacks#run_callbacks'
actionpack (8.1.2) lib/abstract_controller/callbacks.rb:266:in 'AbstractController::Callbacks#process_action'
actionpack (8.1.2) lib/action_controller/metal/rescue.rb:36:in 'ActionController::Rescue#process_action'
actionpack (8.1.2) lib/action_controller/metal/instrumentation.rb:76:in 'block in ActionController::Instrumentation#process_action'
activesupport (8.1.2) lib/active_support/notifications.rb:210:in 'block in ActiveSupport::Notifications.instrument'
activesupport (8.1.2) lib/active_support/notifications/instrumenter.rb:58:in 'ActiveSupport::Notifications::Instrumenter#instrument'
activesupport (8.1.2) lib/active_support/notifications.rb:210:in 'ActiveSupport::Notifications.instrument'
actionpack (8.1.2) lib/action_controller/metal/instrumentation.rb:75:in 'ActionController::Instrumentation#process_action'
actionpack (8.1.2) lib/action_controller/metal/params_wrapper.rb:259:in 'ActionController::ParamsWrapper#process_action'
activerecord (8.1.2) lib/active_record/railties/controller_runtime.rb:39:in 'ActiveRecord::Railties::ControllerRuntime#process_action'
actionpack (8.1.2) lib/abstract_controller/base.rb:154:in 'AbstractController::Base#process'
actionview (8.1.2) lib/action_view/rendering.rb:40:in 'ActionView::Rendering#process'
actionpack (8.1.2) lib/action_controller/metal.rb:252:in 'ActionController::Metal#dispatch'
actionpack (8.1.2) lib/action_controller/metal.rb:335:in 'ActionController::Metal.dispatch'
actionpack (8.1.2) lib/action_dispatch/routing/route_set.rb:65:in 'ActionDispatch::Routing::RouteSet::Dispatcher#dispatch'
actionpack (8.1.2) lib/action_dispatch/routing/route_set.rb:50:in 'ActionDispatch::Routing::RouteSet::Dispatcher#serve'
actionpack (8.1.2) lib/action_dispatch/journey/router.rb:35:in 'block in ActionDispatch::Journey::Router#serve'
actionpack (8.1.2) lib/action_dispatch/journey/router.rb:86:in 'block in ActionDispatch::Journey::Router#recognize'
actionpack (8.1.2) lib/action_dispatch/journey/router.rb:66:in 'Array#each'
actionpack (8.1.2) lib/action_dispatch/journey/router.rb:66:in 'ActionDispatch::Journey::Router#recognize'
actionpack (8.1.2) lib/action_dispatch/journey/router.rb:31:in 'ActionDispatch::Journey::Router#serve'
actionpack (8.1.2) lib/action_dispatch/routing/route_set.rb:906:in 'ActionDispatch::Routing::RouteSet#call'
railties (8.1.2) lib/rails/engine/lazy_route_set.rb:60:in 'Rails::Engine::LazyRouteSet#call'
railties (8.1.2) lib/rails/engine.rb:534:in 'Rails::Engine#call'
railties (8.1.2) lib/rails/railtie.rb:225:in 'Kernel#public_send'
railties (8.1.2) lib/rails/railtie.rb:225:in 'Rails::Railtie.method_missing'
actionpack (8.1.2) lib/action_dispatch/routing/mapper.rb:33:in 'block in <class:Constraints>'
actionpack (8.1.2) lib/action_dispatch/routing/mapper.rb:62:in 'ActionDispatch::Routing::Mapper::Constraints#serve'
actionpack (8.1.2) lib/action_dispatch/journey/router.rb:35:in 'block in ActionDispatch::Journey::Router#serve'
actionpack (8.1.2) lib/action_dispatch/journey/router.rb:92:in 'block in ActionDispatch::Journey::Router#recognize'
actionpack (8.1.2) lib/action_dispatch/journey/router.rb:66:in 'Array#each'
actionpack (8.1.2) lib/action_dispatch/journey/router.rb:66:in 'ActionDispatch::Journey::Router#recognize'
actionpack (8.1.2) lib/action_dispatch/journey/router.rb:31:in 'ActionDispatch::Journey::Router#serve'
actionpack (8.1.2) lib/action_dispatch/routing/route_set.rb:906:in 'ActionDispatch::Routing::RouteSet#call'
railties (8.1.2) lib/rails/engine/lazy_route_set.rb:60:in 'Rails::Engine::LazyRouteSet#call'
rack (3.2.4) lib/rack/tempfile_reaper.rb:20:in 'Rack::TempfileReaper#call'
rack (3.2.4) lib/rack/etag.rb:29:in 'Rack::ETag#call'
rack (3.2.4) lib/rack/conditional_get.rb:44:in 'Rack::ConditionalGet#call'
rack (3.2.4) lib/rack/head.rb:15:in 'Rack::Head#call'
actionpack (8.1.2) lib/action_dispatch/http/content_security_policy.rb:38:in 'ActionDispatch::ContentSecurityPolicy::Middleware#call'
rack-session (2.1.1) lib/rack/session/abstract/id.rb:274:in 'Rack::Session::Abstract::Persisted#context'
rack-session (2.1.1) lib/rack/session/abstract/id.rb:268:in 'Rack::Session::Abstract::Persisted#call'
actionpack (8.1.2) lib/action_dispatch/middleware/cookies.rb:708:in 'ActionDispatch::Cookies#call'
actionpack (8.1.2) lib/action_dispatch/middleware/callbacks.rb:31:in 'block in ActionDispatch::Callbacks#call'
activesupport (8.1.2) lib/active_support/callbacks.rb:101:in 'ActiveSupport::Callbacks#run_callbacks'
actionpack (8.1.2) lib/action_dispatch/middleware/callbacks.rb:30:in 'ActionDispatch::Callbacks#call'
actionpack (8.1.2) lib/action_dispatch/middleware/actionable_exceptions.rb:18:in 'ActionDispatch::ActionableExceptions#call'
actionpack (8.1.2) lib/action_dispatch/middleware/debug_exceptions.rb:31:in 'ActionDispatch::DebugExceptions#call'
actionpack (8.1.2) lib/action_dispatch/middleware/show_exceptions.rb:32:in 'ActionDispatch::ShowExceptions#call'
railties (8.1.2) lib/rails/rack/logger.rb:41:in 'Rails::Rack::Logger#call_app'
railties (8.1.2) lib/rails/rack/logger.rb:29:in 'Rails::Rack::Logger#call'
actionpack (8.1.2) lib/action_dispatch/middleware/remote_ip.rb:98:in 'ActionDispatch::RemoteIp#call'
actionpack (8.1.2) lib/action_dispatch/middleware/request_id.rb:34:in 'ActionDispatch::RequestId#call'
rack (3.2.4) lib/rack/method_override.rb:28:in 'Rack::MethodOverride#call'
rack (3.2.4) lib/rack/runtime.rb:24:in 'Rack::Runtime#call'
actionpack (8.1.2) lib/action_dispatch/middleware/executor.rb:20:in 'ActionDispatch::Executor#call'
actionpack (8.1.2) lib/action_dispatch/middleware/static.rb:27:in 'ActionDispatch::Static#call'
rack (3.2.4) lib/rack/sendfile.rb:131:in 'Rack::Sendfile#call'
railties (8.1.2) lib/rails/engine.rb:534:in 'Rails::Engine#call'
rack-test (2.2.0) lib/rack/test.rb:360:in 'Rack::Test::Session#process_request'
rack-test (2.2.0) lib/rack/test.rb:153:in 'Rack::Test::Session#request'
actionpack (8.1.2) lib/action_dispatch/testing/integration.rb:297:in 'ActionDispatch::Integration::Session#process'
actionpack (8.1.2) lib/action_dispatch/testing/integration.rb:25:in 'ActionDispatch::Integration::RequestHelpers#post'
actionpack (8.1.2) lib/action_dispatch/testing/integration.rb:388:in 'ActionDispatch::Integration::Runner#post'
/Users/bryanbeshore/Desktop/query_lens/test/controllers/queries_controller_test.rb:24:in 'block in <class:QueriesControllerTest>'
minitest (6.0.1) lib/minitest/test.rb:91:in 'block (2 levels) in Minitest::Test#run'
minitest (6.0.1) lib/minitest/test.rb:187:in 'Minitest::Test#capture_exceptions'
minitest (6.0.1) lib/minitest/test.rb:86:in 'block in Minitest::Test#run'
minitest (6.0.1) lib/minitest.rb:396:in 'Minitest::Runnable#time_it'
minitest (6.0.1) lib/minitest/test.rb:85:in 'Minitest::Test#run'
activesupport (8.1.2) lib/active_support/executor/test_helper.rb:5:in 'block in ActiveSupport::Executor::TestHelper#run'
activesupport (8.1.2) lib/active_support/execution_wrapper.rb:104:in 'ActiveSupport::ExecutionWrapper.perform'
activesupport (8.1.2) lib/active_support/executor/test_helper.rb:5:in 'ActiveSupport::Executor::TestHelper#run'
minitest (6.0.1) lib/minitest.rb:485:in 'Minitest::Runnable.run'
minitest (6.0.1) lib/minitest.rb:472:in 'block (2 levels) in Minitest::Runnable.run_suite'
minitest (6.0.1) lib/minitest.rb:468:in 'Array#each'
minitest (6.0.1) lib/minitest.rb:468:in 'block in Minitest::Runnable.run_suite'
minitest (6.0.1) lib/minitest.rb:510:in 'Minitest::Runnable.on_signal'
minitest (6.0.1) lib/minitest.rb:497:in 'Minitest::Runnable.with_info_handler'
minitest (6.0.1) lib/minitest.rb:467:in 'Minitest::Runnable.run_suite'
minitest (6.0.1) lib/minitest.rb:360:in 'block in Minitest.run_all_suites'
minitest (6.0.1) lib/minitest.rb:360:in 'Array#map'
minitest (6.0.1) lib/minitest.rb:360:in 'Minitest.run_all_suites'
minitest (6.0.1) lib/minitest.rb:315:in 'Minitest.run'
minitest (6.0.1) lib/minitest.rb:84:in 'block in Minitest.autorun'
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK TRANSACTION[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[36mBEGIN deferred TRANSACTION[0m
--------------------------------------------------------------------------------
QueryLens::QueriesControllerTest: test_authentication_blocks_unauthorized_access
--------------------------------------------------------------------------------
  [1m[35m (0.1ms)[0m  [1m[35mDROP TABLE IF EXISTS "users"[0m
  [1m[35m (0.1ms)[0m  [1m[35mCREATE TABLE "users" ("id" integer PRIMARY KEY AUTOINCREMENT NOT NULL, "name" varchar, "email" varchar, "created_at" datetime(6) NOT NULL, "updated_at" datetime(6) NOT NULL)[0m
  [1m[35m (0.0ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" varchar NOT NULL PRIMARY KEY)[0m
  [1m[35m (0.0ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" varchar NOT NULL PRIMARY KEY, "value" varchar, "created_at" datetime(6) NOT NULL, "updated_at" datetime(6) NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.0ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::InternalMetadata Create (0.0ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES ('environment', 'test', '2026-02-07 18:17:04.192322', '2026-02-07 18:17:04.192324') RETURNING "key"[0m
  [1m[35m (0.0ms)[0m  [1m[32mINSERT INTO users (name, email, created_at, updated_at) VALUES ('Alice', 'alice@example.com', datetime('now'), datetime('now'))[0m
  [1m[35m (0.0ms)[0m  [1m[32mINSERT INTO users (name, email, created_at, updated_at) VALUES ('Bob', 'bob@example.com', datetime('now'), datetime('now'))[0m
Started GET "/query_lens/" for 127.0.0.1 at 2026-02-07 13:17:04 -0500
Processing by QueryLens::QueriesController#show as HTML
Filter chain halted as :authenticate! rendered or redirected
Completed 401 Unauthorized in 0ms (ActiveRecord: 0.0ms (0 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[31mROLLBACK TRANSACTION[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[36mBEGIN deferred TRANSACTION[0m
------------------------------------------------------------------------
QueryLens::QueriesControllerTest: test_execute_rejects_INSERT_statements
------------------------------------------------------------------------
  [1m[35m (0.0ms)[0m  [1m[35mDROP TABLE IF EXISTS "users"[0m
  [1m[35m (0.0ms)[0m  [1m[35mCREATE TABLE "users" ("id" integer PRIMARY KEY AUTOINCREMENT NOT NULL, "name" varchar, "email" varchar, "created_at" datetime(6) NOT NULL, "updated_at" datetime(6) NOT NULL)[0m
  [1m[35m (0.0ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" varchar NOT NULL PRIMARY KEY)[0m
  [1m[35m (0.0ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" varchar NOT NULL PRIMARY KEY, "value" varchar, "created_at" datetime(6) NOT NULL, "updated_at" datetime(6) NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.0ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::InternalMetadata Create (0.0ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES ('environment', 'test', '2026-02-07 18:17:04.194306', '2026-02-07 18:17:04.194306') RETURNING "key"[0m
  [1m[35m (0.0ms)[0m  [1m[32mINSERT INTO users (name, email, created_at, updated_at) VALUES ('Alice', 'alice@example.com', datetime('now'), datetime('now'))[0m
  [1m[35m (0.0ms)[0m  [1m[32mINSERT INTO users (name, email, created_at, updated_at) VALUES ('Bob', 'bob@example.com', datetime('now'), datetime('now'))[0m
Started POST "/query_lens/execute" for 127.0.0.1 at 2026-02-07 13:17:04 -0500
Processing by QueryLens::QueriesController#execute as JSON
  Parameters: {"sql" => "INSERT INTO users (name) VALUES ('hacker')", "query" => {"sql" => "INSERT INTO users (name) VALUES ('hacker')"}}
Can't verify CSRF token authenticity.
Completed 422 Unprocessable Content in 0ms (ActiveRecord: 0.0ms (0 queries, 0 cached) | GC: 0.0ms)
  
ActionController::InvalidAuthenticityToken (Can't verify CSRF token authenticity.):
  
actionpack (8.1.2) lib/action_controller/metal/request_forgery_protection.rb:321:in 'ActionController::RequestForgeryProtection::ProtectionMethods::Exception#handle_unverified_request'
actionpack (8.1.2) lib/action_controller/metal/request_forgery_protection.rb:415:in 'ActionController::RequestForgeryProtection#handle_unverified_request'
actionpack (8.1.2) lib/action_controller/metal/request_forgery_protection.rb:404:in 'ActionController::RequestForgeryProtection#verify_authenticity_token'
activesupport (8.1.2) lib/active_support/callbacks.rb:362:in 'block in ActiveSupport::Callbacks::CallTemplate::MethodCall#make_lambda'
activesupport (8.1.2) lib/active_support/callbacks.rb:179:in 'block in ActiveSupport::Callbacks::Filters::Before#call'
actionpack (8.1.2) lib/abstract_controller/callbacks.rb:36:in 'block (2 levels) in <module:Callbacks>'
activesupport (8.1.2) lib/active_support/callbacks.rb:180:in 'ActiveSupport::Callbacks::Filters::Before#call'
activesupport (8.1.2) lib/active_support/callbacks.rb:560:in 'block in ActiveSupport::Callbacks::CallbackSequence#invoke_before'
activesupport (8.1.2) lib/active_support/callbacks.rb:560:in 'Array#each'
activesupport (8.1.2) lib/active_support/callbacks.rb:560:in 'ActiveSupport::Callbacks::CallbackSequence#invoke_before'
activesupport (8.1.2) lib/active_support/callbacks.rb:109:in 'ActiveSupport::Callbacks#run_callbacks'
actionpack (8.1.2) lib/abstract_controller/callbacks.rb:266:in 'AbstractController::Callbacks#process_action'
actionpack (8.1.2) lib/action_controller/metal/rescue.rb:36:in 'ActionController::Rescue#process_action'
actionpack (8.1.2) lib/action_controller/metal/instrumentation.rb:76:in 'block in ActionController::Instrumentation#process_action'
activesupport (8.1.2) lib/active_support/notifications.rb:210:in 'block in ActiveSupport::Notifications.instrument'
activesupport (8.1.2) lib/active_support/notifications/instrumenter.rb:58:in 'ActiveSupport::Notifications::Instrumenter#instrument'
activesupport (8.1.2) lib/active_support/notifications.rb:210:in 'ActiveSupport::Notifications.instrument'
actionpack (8.1.2) lib/action_controller/metal/instrumentation.rb:75:in 'ActionController::Instrumentation#process_action'
actionpack (8.1.2) lib/action_controller/metal/params_wrapper.rb:259:in 'ActionController::ParamsWrapper#process_action'
activerecord (8.1.2) lib/active_record/railties/controller_runtime.rb:39:in 'ActiveRecord::Railties::ControllerRuntime#process_action'
actionpack (8.1.2) lib/abstract_controller/base.rb:154:in 'AbstractController::Base#process'
actionview (8.1.2) lib/action_view/rendering.rb:40:in 'ActionView::Rendering#process'
actionpack (8.1.2) lib/action_controller/metal.rb:252:in 'ActionController::Metal#dispatch'
actionpack (8.1.2) lib/action_controller/metal.rb:335:in 'ActionController::Metal.dispatch'
actionpack (8.1.2) lib/action_dispatch/routing/route_set.rb:65:in 'ActionDispatch::Routing::RouteSet::Dispatcher#dispatch'
actionpack (8.1.2) lib/action_dispatch/routing/route_set.rb:50:in 'ActionDispatch::Routing::RouteSet::Dispatcher#serve'
actionpack (8.1.2) lib/action_dispatch/journey/router.rb:35:in 'block in ActionDispatch::Journey::Router#serve'
actionpack (8.1.2) lib/action_dispatch/journey/router.rb:86:in 'block in ActionDispatch::Journey::Router#recognize'
actionpack (8.1.2) lib/action_dispatch/journey/router.rb:66:in 'Array#each'
actionpack (8.1.2) lib/action_dispatch/journey/router.rb:66:in 'ActionDispatch::Journey::Router#recognize'
actionpack (8.1.2) lib/action_dispatch/journey/router.rb:31:in 'ActionDispatch::Journey::Router#serve'
actionpack (8.1.2) lib/action_dispatch/routing/route_set.rb:906:in 'ActionDispatch::Routing::RouteSet#call'
railties (8.1.2) lib/rails/engine/lazy_route_set.rb:60:in 'Rails::Engine::LazyRouteSet#call'
railties (8.1.2) lib/rails/engine.rb:534:in 'Rails::Engine#call'
railties (8.1.2) lib/rails/railtie.rb:225:in 'Kernel#public_send'
railties (8.1.2) lib/rails/railtie.rb:225:in 'Rails::Railtie.method_missing'
actionpack (8.1.2) lib/action_dispatch/routing/mapper.rb:33:in 'block in <class:Constraints>'
actionpack (8.1.2) lib/action_dispatch/routing/mapper.rb:62:in 'ActionDispatch::Routing::Mapper::Constraints#serve'
actionpack (8.1.2) lib/action_dispatch/journey/router.rb:35:in 'block in ActionDispatch::Journey::Router#serve'
actionpack (8.1.2) lib/action_dispatch/journey/router.rb:92:in 'block in ActionDispatch::Journey::Router#recognize'
actionpack (8.1.2) lib/action_dispatch/journey/router.rb:66:in 'Array#each'
actionpack (8.1.2) lib/action_dispatch/journey/router.rb:66:in 'ActionDispatch::Journey::Router#recognize'
actionpack (8.1.2) lib/action_dispatch/journey/router.rb:31:in 'ActionDispatch::Journey::Router#serve'
actionpack (8.1.2) lib/action_dispatch/routing/route_set.rb:906:in 'ActionDispatch::Routing::RouteSet#call'
railties (8.1.2) lib/rails/engine/lazy_route_set.rb:60:in 'Rails::Engine::LazyRouteSet#call'
rack (3.2.4) lib/rack/tempfile_reaper.rb:20:in 'Rack::TempfileReaper#call'
rack (3.2.4) lib/rack/etag.rb:29:in 'Rack::ETag#call'
rack (3.2.4) lib/rack/conditional_get.rb:44:in 'Rack::ConditionalGet#call'
rack (3.2.4) lib/rack/head.rb:15:in 'Rack::Head#call'
actionpack (8.1.2) lib/action_dispatch/http/content_security_policy.rb:38:in 'ActionDispatch::ContentSecurityPolicy::Middleware#call'
rack-session (2.1.1) lib/rack/session/abstract/id.rb:274:in 'Rack::Session::Abstract::Persisted#context'
rack-session (2.1.1) lib/rack/session/abstract/id.rb:268:in 'Rack::Session::Abstract::Persisted#call'
actionpack (8.1.2) lib/action_dispatch/middleware/cookies.rb:708:in 'ActionDispatch::Cookies#call'
actionpack (8.1.2) lib/action_dispatch/middleware/callbacks.rb:31:in 'block in ActionDispatch::Callbacks#call'
activesupport (8.1.2) lib/active_support/callbacks.rb:101:in 'ActiveSupport::Callbacks#run_callbacks'
actionpack (8.1.2) lib/action_dispatch/middleware/callbacks.rb:30:in 'ActionDispatch::Callbacks#call'
actionpack (8.1.2) lib/action_dispatch/middleware/actionable_exceptions.rb:18:in 'ActionDispatch::ActionableExceptions#call'
actionpack (8.1.2) lib/action_dispatch/middleware/debug_exceptions.rb:31:in 'ActionDispatch::DebugExceptions#call'
actionpack (8.1.2) lib/action_dispatch/middleware/show_exceptions.rb:32:in 'ActionDispatch::ShowExceptions#call'
railties (8.1.2) lib/rails/rack/logger.rb:41:in 'Rails::Rack::Logger#call_app'
railties (8.1.2) lib/rails/rack/logger.rb:29:in 'Rails::Rack::Logger#call'
actionpack (8.1.2) lib/action_dispatch/middleware/remote_ip.rb:98:in 'ActionDispatch::RemoteIp#call'
actionpack (8.1.2) lib/action_dispatch/middleware/request_id.rb:34:in 'ActionDispatch::RequestId#call'
rack (3.2.4) lib/rack/method_override.rb:28:in 'Rack::MethodOverride#call'
rack (3.2.4) lib/rack/runtime.rb:24:in 'Rack::Runtime#call'
actionpack (8.1.2) lib/action_dispatch/middleware/executor.rb:20:in 'ActionDispatch::Executor#call'
actionpack (8.1.2) lib/action_dispatch/middleware/static.rb:27:in 'ActionDispatch::Static#call'
rack (3.2.4) lib/rack/sendfile.rb:131:in 'Rack::Sendfile#call'
railties (8.1.2) lib/rails/engine.rb:534:in 'Rails::Engine#call'
rack-test (2.2.0) lib/rack/test.rb:360:in 'Rack::Test::Session#process_request'
rack-test (2.2.0) lib/rack/test.rb:153:in 'Rack::Test::Session#request'
actionpack (8.1.2) lib/action_dispatch/testing/integration.rb:297:in 'ActionDispatch::Integration::Session#process'
actionpack (8.1.2) lib/action_dispatch/testing/integration.rb:25:in 'ActionDispatch::Integration::RequestHelpers#post'
actionpack (8.1.2) lib/action_dispatch/testing/integration.rb:388:in 'ActionDispatch::Integration::Runner#post'
/Users/bryanbeshore/Desktop/query_lens/test/controllers/queries_controller_test.rb:42:in 'block in <class:QueriesControllerTest>'
minitest (6.0.1) lib/minitest/test.rb:91:in 'block (2 levels) in Minitest::Test#run'
minitest (6.0.1) lib/minitest/test.rb:187:in 'Minitest::Test#capture_exceptions'
minitest (6.0.1) lib/minitest/test.rb:86:in 'block in Minitest::Test#run'
minitest (6.0.1) lib/minitest.rb:396:in 'Minitest::Runnable#time_it'
minitest (6.0.1) lib/minitest/test.rb:85:in 'Minitest::Test#run'
activesupport (8.1.2) lib/active_support/executor/test_helper.rb:5:in 'block in ActiveSupport::Executor::TestHelper#run'
activesupport (8.1.2) lib/active_support/execution_wrapper.rb:104:in 'ActiveSupport::ExecutionWrapper.perform'
activesupport (8.1.2) lib/active_support/executor/test_helper.rb:5:in 'ActiveSupport::Executor::TestHelper#run'
minitest (6.0.1) lib/minitest.rb:485:in 'Minitest::Runnable.run'
minitest (6.0.1) lib/minitest.rb:472:in 'block (2 levels) in Minitest::Runnable.run_suite'
minitest (6.0.1) lib/minitest.rb:468:in 'Array#each'
minitest (6.0.1) lib/minitest.rb:468:in 'block in Minitest::Runnable.run_suite'
minitest (6.0.1) lib/minitest.rb:510:in 'Minitest::Runnable.on_signal'
minitest (6.0.1) lib/minitest.rb:497:in 'Minitest::Runnable.with_info_handler'
minitest (6.0.1) lib/minitest.rb:467:in 'Minitest::Runnable.run_suite'
minitest (6.0.1) lib/minitest.rb:360:in 'block in Minitest.run_all_suites'
minitest (6.0.1) lib/minitest.rb:360:in 'Array#map'
minitest (6.0.1) lib/minitest.rb:360:in 'Minitest.run_all_suites'
minitest (6.0.1) lib/minitest.rb:315:in 'Minitest.run'
minitest (6.0.1) lib/minitest.rb:84:in 'block in Minitest.autorun'
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK TRANSACTION[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[36mBEGIN deferred TRANSACTION[0m
------------------------------------------------------------------------------
QueryLens::QueriesControllerTest: test_execute_respects_max_rows_configuration
------------------------------------------------------------------------------
  [1m[35m (0.1ms)[0m  [1m[35mDROP TABLE IF EXISTS "users"[0m
  [1m[35m (0.1ms)[0m  [1m[35mCREATE TABLE "users" ("id" integer PRIMARY KEY AUTOINCREMENT NOT NULL, "name" varchar, "email" varchar, "created_at" datetime(6) NOT NULL, "updated_at" datetime(6) NOT NULL)[0m
  [1m[35m (0.0ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" varchar NOT NULL PRIMARY KEY)[0m
  [1m[35m (0.0ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" varchar NOT NULL PRIMARY KEY, "value" varchar, "created_at" datetime(6) NOT NULL, "updated_at" datetime(6) NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.0ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::InternalMetadata Create (0.0ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES ('environment', 'test', '2026-02-07 18:17:04.284943', '2026-02-07 18:17:04.284945') RETURNING "key"[0m
  [1m[35m (0.0ms)[0m  [1m[32mINSERT INTO users (name, email, created_at, updated_at) VALUES ('Alice', 'alice@example.com', datetime('now'), datetime('now'))[0m
  [1m[35m (0.0ms)[0m  [1m[32mINSERT INTO users (name, email, created_at, updated_at) VALUES ('Bob', 'bob@example.com', datetime('now'), datetime('now'))[0m
Started POST "/query_lens/execute" for 127.0.0.1 at 2026-02-07 13:17:04 -0500
Processing by QueryLens::QueriesController#execute as JSON
  Parameters: {"sql" => "SELECT * FROM users", "query" => {"sql" => "SELECT * FROM users"}}
Can't verify CSRF token authenticity.
Completed 422 Unprocessable Content in 0ms (ActiveRecord: 0.0ms (0 queries, 0 cached) | GC: 0.0ms)
  
ActionController::InvalidAuthenticityToken (Can't verify CSRF token authenticity.):
  
actionpack (8.1.2) lib/action_controller/metal/request_forgery_protection.rb:321:in 'ActionController::RequestForgeryProtection::ProtectionMethods::Exception#handle_unverified_request'
actionpack (8.1.2) lib/action_controller/metal/request_forgery_protection.rb:415:in 'ActionController::RequestForgeryProtection#handle_unverified_request'
actionpack (8.1.2) lib/action_controller/metal/request_forgery_protection.rb:404:in 'ActionController::RequestForgeryProtection#verify_authenticity_token'
activesupport (8.1.2) lib/active_support/callbacks.rb:362:in 'block in ActiveSupport::Callbacks::CallTemplate::MethodCall#make_lambda'
activesupport (8.1.2) lib/active_support/callbacks.rb:179:in 'block in ActiveSupport::Callbacks::Filters::Before#call'
actionpack (8.1.2) lib/abstract_controller/callbacks.rb:36:in 'block (2 levels) in <module:Callbacks>'
activesupport (8.1.2) lib/active_support/callbacks.rb:180:in 'ActiveSupport::Callbacks::Filters::Before#call'
activesupport (8.1.2) lib/active_support/callbacks.rb:560:in 'block in ActiveSupport::Callbacks::CallbackSequence#invoke_before'
activesupport (8.1.2) lib/active_support/callbacks.rb:560:in 'Array#each'
activesupport (8.1.2) lib/active_support/callbacks.rb:560:in 'ActiveSupport::Callbacks::CallbackSequence#invoke_before'
activesupport (8.1.2) lib/active_support/callbacks.rb:109:in 'ActiveSupport::Callbacks#run_callbacks'
actionpack (8.1.2) lib/abstract_controller/callbacks.rb:266:in 'AbstractController::Callbacks#process_action'
actionpack (8.1.2) lib/action_controller/metal/rescue.rb:36:in 'ActionController::Rescue#process_action'
actionpack (8.1.2) lib/action_controller/metal/instrumentation.rb:76:in 'block in ActionController::Instrumentation#process_action'
activesupport (8.1.2) lib/active_support/notifications.rb:210:in 'block in ActiveSupport::Notifications.instrument'
activesupport (8.1.2) lib/active_support/notifications/instrumenter.rb:58:in 'ActiveSupport::Notifications::Instrumenter#instrument'
activesupport (8.1.2) lib/active_support/notifications.rb:210:in 'ActiveSupport::Notifications.instrument'
actionpack (8.1.2) lib/action_controller/metal/instrumentation.rb:75:in 'ActionController::Instrumentation#process_action'
actionpack (8.1.2) lib/action_controller/metal/params_wrapper.rb:259:in 'ActionController::ParamsWrapper#process_action'
activerecord (8.1.2) lib/active_record/railties/controller_runtime.rb:39:in 'ActiveRecord::Railties::ControllerRuntime#process_action'
actionpack (8.1.2) lib/abstract_controller/base.rb:154:in 'AbstractController::Base#process'
actionview (8.1.2) lib/action_view/rendering.rb:40:in 'ActionView::Rendering#process'
actionpack (8.1.2) lib/action_controller/metal.rb:252:in 'ActionController::Metal#dispatch'
actionpack (8.1.2) lib/action_controller/metal.rb:335:in 'ActionController::Metal.dispatch'
actionpack (8.1.2) lib/action_dispatch/routing/route_set.rb:65:in 'ActionDispatch::Routing::RouteSet::Dispatcher#dispatch'
actionpack (8.1.2) lib/action_dispatch/routing/route_set.rb:50:in 'ActionDispatch::Routing::RouteSet::Dispatcher#serve'
actionpack (8.1.2) lib/action_dispatch/journey/router.rb:35:in 'block in ActionDispatch::Journey::Router#serve'
actionpack (8.1.2) lib/action_dispatch/journey/router.rb:86:in 'block in ActionDispatch::Journey::Router#recognize'
actionpack (8.1.2) lib/action_dispatch/journey/router.rb:66:in 'Array#each'
actionpack (8.1.2) lib/action_dispatch/journey/router.rb:66:in 'ActionDispatch::Journey::Router#recognize'
actionpack (8.1.2) lib/action_dispatch/journey/router.rb:31:in 'ActionDispatch::Journey::Router#serve'
actionpack (8.1.2) lib/action_dispatch/routing/route_set.rb:906:in 'ActionDispatch::Routing::RouteSet#call'
railties (8.1.2) lib/rails/engine/lazy_route_set.rb:60:in 'Rails::Engine::LazyRouteSet#call'
railties (8.1.2) lib/rails/engine.rb:534:in 'Rails::Engine#call'
railties (8.1.2) lib/rails/railtie.rb:225:in 'Kernel#public_send'
railties (8.1.2) lib/rails/railtie.rb:225:in 'Rails::Railtie.method_missing'
actionpack (8.1.2) lib/action_dispatch/routing/mapper.rb:33:in 'block in <class:Constraints>'
actionpack (8.1.2) lib/action_dispatch/routing/mapper.rb:62:in 'ActionDispatch::Routing::Mapper::Constraints#serve'
actionpack (8.1.2) lib/action_dispatch/journey/router.rb:35:in 'block in ActionDispatch::Journey::Router#serve'
actionpack (8.1.2) lib/action_dispatch/journey/router.rb:92:in 'block in ActionDispatch::Journey::Router#recognize'
actionpack (8.1.2) lib/action_dispatch/journey/router.rb:66:in 'Array#each'
actionpack (8.1.2) lib/action_dispatch/journey/router.rb:66:in 'ActionDispatch::Journey::Router#recognize'
actionpack (8.1.2) lib/action_dispatch/journey/router.rb:31:in 'ActionDispatch::Journey::Router#serve'
actionpack (8.1.2) lib/action_dispatch/routing/route_set.rb:906:in 'ActionDispatch::Routing::RouteSet#call'
railties (8.1.2) lib/rails/engine/lazy_route_set.rb:60:in 'Rails::Engine::LazyRouteSet#call'
rack (3.2.4) lib/rack/tempfile_reaper.rb:20:in 'Rack::TempfileReaper#call'
rack (3.2.4) lib/rack/etag.rb:29:in 'Rack::ETag#call'
rack (3.2.4) lib/rack/conditional_get.rb:44:in 'Rack::ConditionalGet#call'
rack (3.2.4) lib/rack/head.rb:15:in 'Rack::Head#call'
actionpack (8.1.2) lib/action_dispatch/http/content_security_policy.rb:38:in 'ActionDispatch::ContentSecurityPolicy::Middleware#call'
rack-session (2.1.1) lib/rack/session/abstract/id.rb:274:in 'Rack::Session::Abstract::Persisted#context'
rack-session (2.1.1) lib/rack/session/abstract/id.rb:268:in 'Rack::Session::Abstract::Persisted#call'
actionpack (8.1.2) lib/action_dispatch/middleware/cookies.rb:708:in 'ActionDispatch::Cookies#call'
actionpack (8.1.2) lib/action_dispatch/middleware/callbacks.rb:31:in 'block in ActionDispatch::Callbacks#call'
activesupport (8.1.2) lib/active_support/callbacks.rb:101:in 'ActiveSupport::Callbacks#run_callbacks'
actionpack (8.1.2) lib/action_dispatch/middleware/callbacks.rb:30:in 'ActionDispatch::Callbacks#call'
actionpack (8.1.2) lib/action_dispatch/middleware/actionable_exceptions.rb:18:in 'ActionDispatch::ActionableExceptions#call'
actionpack (8.1.2) lib/action_dispatch/middleware/debug_exceptions.rb:31:in 'ActionDispatch::DebugExceptions#call'
actionpack (8.1.2) lib/action_dispatch/middleware/show_exceptions.rb:32:in 'ActionDispatch::ShowExceptions#call'
railties (8.1.2) lib/rails/rack/logger.rb:41:in 'Rails::Rack::Logger#call_app'
railties (8.1.2) lib/rails/rack/logger.rb:29:in 'Rails::Rack::Logger#call'
actionpack (8.1.2) lib/action_dispatch/middleware/remote_ip.rb:98:in 'ActionDispatch::RemoteIp#call'
actionpack (8.1.2) lib/action_dispatch/middleware/request_id.rb:34:in 'ActionDispatch::RequestId#call'
rack (3.2.4) lib/rack/method_override.rb:28:in 'Rack::MethodOverride#call'
rack (3.2.4) lib/rack/runtime.rb:24:in 'Rack::Runtime#call'
actionpack (8.1.2) lib/action_dispatch/middleware/executor.rb:20:in 'ActionDispatch::Executor#call'
actionpack (8.1.2) lib/action_dispatch/middleware/static.rb:27:in 'ActionDispatch::Static#call'
rack (3.2.4) lib/rack/sendfile.rb:131:in 'Rack::Sendfile#call'
railties (8.1.2) lib/rails/engine.rb:534:in 'Rails::Engine#call'
rack-test (2.2.0) lib/rack/test.rb:360:in 'Rack::Test::Session#process_request'
rack-test (2.2.0) lib/rack/test.rb:153:in 'Rack::Test::Session#request'
actionpack (8.1.2) lib/action_dispatch/testing/integration.rb:297:in 'ActionDispatch::Integration::Session#process'
actionpack (8.1.2) lib/action_dispatch/testing/integration.rb:25:in 'ActionDispatch::Integration::RequestHelpers#post'
actionpack (8.1.2) lib/action_dispatch/testing/integration.rb:388:in 'ActionDispatch::Integration::Runner#post'
/Users/bryanbeshore/Desktop/query_lens/test/controllers/queries_controller_test.rb:72:in 'block in <class:QueriesControllerTest>'
minitest (6.0.1) lib/minitest/test.rb:91:in 'block (2 levels) in Minitest::Test#run'
minitest (6.0.1) lib/minitest/test.rb:187:in 'Minitest::Test#capture_exceptions'
minitest (6.0.1) lib/minitest/test.rb:86:in 'block in Minitest::Test#run'
minitest (6.0.1) lib/minitest.rb:396:in 'Minitest::Runnable#time_it'
minitest (6.0.1) lib/minitest/test.rb:85:in 'Minitest::Test#run'
activesupport (8.1.2) lib/active_support/executor/test_helper.rb:5:in 'block in ActiveSupport::Executor::TestHelper#run'
activesupport (8.1.2) lib/active_support/execution_wrapper.rb:104:in 'ActiveSupport::ExecutionWrapper.perform'
activesupport (8.1.2) lib/active_support/executor/test_helper.rb:5:in 'ActiveSupport::Executor::TestHelper#run'
minitest (6.0.1) lib/minitest.rb:485:in 'Minitest::Runnable.run'
minitest (6.0.1) lib/minitest.rb:472:in 'block (2 levels) in Minitest::Runnable.run_suite'
minitest (6.0.1) lib/minitest.rb:468:in 'Array#each'
minitest (6.0.1) lib/minitest.rb:468:in 'block in Minitest::Runnable.run_suite'
minitest (6.0.1) lib/minitest.rb:510:in 'Minitest::Runnable.on_signal'
minitest (6.0.1) lib/minitest.rb:497:in 'Minitest::Runnable.with_info_handler'
minitest (6.0.1) lib/minitest.rb:467:in 'Minitest::Runnable.run_suite'
minitest (6.0.1) lib/minitest.rb:360:in 'block in Minitest.run_all_suites'
minitest (6.0.1) lib/minitest.rb:360:in 'Array#map'
minitest (6.0.1) lib/minitest.rb:360:in 'Minitest.run_all_suites'
minitest (6.0.1) lib/minitest.rb:315:in 'Minitest.run'
minitest (6.0.1) lib/minitest.rb:84:in 'block in Minitest.autorun'
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK TRANSACTION[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[36mBEGIN deferred TRANSACTION[0m
-------------------------------------------------------------------------
QueryLens::QueriesControllerTest: test_execute_rejects_non-SELECT_queries
-------------------------------------------------------------------------
  [1m[35m (0.0ms)[0m  [1m[35mDROP TABLE IF EXISTS "users"[0m
  [1m[35m (0.1ms)[0m  [1m[35mCREATE TABLE "users" ("id" integer PRIMARY KEY AUTOINCREMENT NOT NULL, "name" varchar, "email" varchar, "created_at" datetime(6) NOT NULL, "updated_at" datetime(6) NOT NULL)[0m
  [1m[35m (0.0ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" varchar NOT NULL PRIMARY KEY)[0m
  [1m[35m (0.0ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" varchar NOT NULL PRIMARY KEY, "value" varchar, "created_at" datetime(6) NOT NULL, "updated_at" datetime(6) NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.0ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::InternalMetadata Create (0.0ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES ('environment', 'test', '2026-02-07 18:17:04.383267', '2026-02-07 18:17:04.383269') RETURNING "key"[0m
  [1m[35m (0.0ms)[0m  [1m[32mINSERT INTO users (name, email, created_at, updated_at) VALUES ('Alice', 'alice@example.com', datetime('now'), datetime('now'))[0m
  [1m[35m (0.0ms)[0m  [1m[32mINSERT INTO users (name, email, created_at, updated_at) VALUES ('Bob', 'bob@example.com', datetime('now'), datetime('now'))[0m
Started POST "/query_lens/execute" for 127.0.0.1 at 2026-02-07 13:17:04 -0500
Processing by QueryLens::QueriesController#execute as JSON
  Parameters: {"sql" => "DELETE FROM users", "query" => {"sql" => "DELETE FROM users"}}
Can't verify CSRF token authenticity.
Completed 422 Unprocessable Content in 0ms (ActiveRecord: 0.0ms (0 queries, 0 cached) | GC: 0.0ms)
  
ActionController::InvalidAuthenticityToken (Can't verify CSRF token authenticity.):
  
actionpack (8.1.2) lib/action_controller/metal/request_forgery_protection.rb:321:in 'ActionController::RequestForgeryProtection::ProtectionMethods::Exception#handle_unverified_request'
actionpack (8.1.2) lib/action_controller/metal/request_forgery_protection.rb:415:in 'ActionController::RequestForgeryProtection#handle_unverified_request'
actionpack (8.1.2) lib/action_controller/metal/request_forgery_protection.rb:404:in 'ActionController::RequestForgeryProtection#verify_authenticity_token'
activesupport (8.1.2) lib/active_support/callbacks.rb:362:in 'block in ActiveSupport::Callbacks::CallTemplate::MethodCall#make_lambda'
activesupport (8.1.2) lib/active_support/callbacks.rb:179:in 'block in ActiveSupport::Callbacks::Filters::Before#call'
actionpack (8.1.2) lib/abstract_controller/callbacks.rb:36:in 'block (2 levels) in <module:Callbacks>'
activesupport (8.1.2) lib/active_support/callbacks.rb:180:in 'ActiveSupport::Callbacks::Filters::Before#call'
activesupport (8.1.2) lib/active_support/callbacks.rb:560:in 'block in ActiveSupport::Callbacks::CallbackSequence#invoke_before'
activesupport (8.1.2) lib/active_support/callbacks.rb:560:in 'Array#each'
activesupport (8.1.2) lib/active_support/callbacks.rb:560:in 'ActiveSupport::Callbacks::CallbackSequence#invoke_before'
activesupport (8.1.2) lib/active_support/callbacks.rb:109:in 'ActiveSupport::Callbacks#run_callbacks'
actionpack (8.1.2) lib/abstract_controller/callbacks.rb:266:in 'AbstractController::Callbacks#process_action'
actionpack (8.1.2) lib/action_controller/metal/rescue.rb:36:in 'ActionController::Rescue#process_action'
actionpack (8.1.2) lib/action_controller/metal/instrumentation.rb:76:in 'block in ActionController::Instrumentation#process_action'
activesupport (8.1.2) lib/active_support/notifications.rb:210:in 'block in ActiveSupport::Notifications.instrument'
activesupport (8.1.2) lib/active_support/notifications/instrumenter.rb:58:in 'ActiveSupport::Notifications::Instrumenter#instrument'
activesupport (8.1.2) lib/active_support/notifications.rb:210:in 'ActiveSupport::Notifications.instrument'
actionpack (8.1.2) lib/action_controller/metal/instrumentation.rb:75:in 'ActionController::Instrumentation#process_action'
actionpack (8.1.2) lib/action_controller/metal/params_wrapper.rb:259:in 'ActionController::ParamsWrapper#process_action'
activerecord (8.1.2) lib/active_record/railties/controller_runtime.rb:39:in 'ActiveRecord::Railties::ControllerRuntime#process_action'
actionpack (8.1.2) lib/abstract_controller/base.rb:154:in 'AbstractController::Base#process'
actionview (8.1.2) lib/action_view/rendering.rb:40:in 'ActionView::Rendering#process'
actionpack (8.1.2) lib/action_controller/metal.rb:252:in 'ActionController::Metal#dispatch'
actionpack (8.1.2) lib/action_controller/metal.rb:335:in 'ActionController::Metal.dispatch'
actionpack (8.1.2) lib/action_dispatch/routing/route_set.rb:65:in 'ActionDispatch::Routing::RouteSet::Dispatcher#dispatch'
actionpack (8.1.2) lib/action_dispatch/routing/route_set.rb:50:in 'ActionDispatch::Routing::RouteSet::Dispatcher#serve'
actionpack (8.1.2) lib/action_dispatch/journey/router.rb:35:in 'block in ActionDispatch::Journey::Router#serve'
actionpack (8.1.2) lib/action_dispatch/journey/router.rb:86:in 'block in ActionDispatch::Journey::Router#recognize'
actionpack (8.1.2) lib/action_dispatch/journey/router.rb:66:in 'Array#each'
actionpack (8.1.2) lib/action_dispatch/journey/router.rb:66:in 'ActionDispatch::Journey::Router#recognize'
actionpack (8.1.2) lib/action_dispatch/journey/router.rb:31:in 'ActionDispatch::Journey::Router#serve'
actionpack (8.1.2) lib/action_dispatch/routing/route_set.rb:906:in 'ActionDispatch::Routing::RouteSet#call'
railties (8.1.2) lib/rails/engine/lazy_route_set.rb:60:in 'Rails::Engine::LazyRouteSet#call'
railties (8.1.2) lib/rails/engine.rb:534:in 'Rails::Engine#call'
railties (8.1.2) lib/rails/railtie.rb:225:in 'Kernel#public_send'
railties (8.1.2) lib/rails/railtie.rb:225:in 'Rails::Railtie.method_missing'
actionpack (8.1.2) lib/action_dispatch/routing/mapper.rb:33:in 'block in <class:Constraints>'
actionpack (8.1.2) lib/action_dispatch/routing/mapper.rb:62:in 'ActionDispatch::Routing::Mapper::Constraints#serve'
actionpack (8.1.2) lib/action_dispatch/journey/router.rb:35:in 'block in ActionDispatch::Journey::Router#serve'
actionpack (8.1.2) lib/action_dispatch/journey/router.rb:92:in 'block in ActionDispatch::Journey::Router#recognize'
actionpack (8.1.2) lib/action_dispatch/journey/router.rb:66:in 'Array#each'
actionpack (8.1.2) lib/action_dispatch/journey/router.rb:66:in 'ActionDispatch::Journey::Router#recognize'
actionpack (8.1.2) lib/action_dispatch/journey/router.rb:31:in 'ActionDispatch::Journey::Router#serve'
actionpack (8.1.2) lib/action_dispatch/routing/route_set.rb:906:in 'ActionDispatch::Routing::RouteSet#call'
railties (8.1.2) lib/rails/engine/lazy_route_set.rb:60:in 'Rails::Engine::LazyRouteSet#call'
rack (3.2.4) lib/rack/tempfile_reaper.rb:20:in 'Rack::TempfileReaper#call'
rack (3.2.4) lib/rack/etag.rb:29:in 'Rack::ETag#call'
rack (3.2.4) lib/rack/conditional_get.rb:44:in 'Rack::ConditionalGet#call'
rack (3.2.4) lib/rack/head.rb:15:in 'Rack::Head#call'
actionpack (8.1.2) lib/action_dispatch/http/content_security_policy.rb:38:in 'ActionDispatch::ContentSecurityPolicy::Middleware#call'
rack-session (2.1.1) lib/rack/session/abstract/id.rb:274:in 'Rack::Session::Abstract::Persisted#context'
rack-session (2.1.1) lib/rack/session/abstract/id.rb:268:in 'Rack::Session::Abstract::Persisted#call'
actionpack (8.1.2) lib/action_dispatch/middleware/cookies.rb:708:in 'ActionDispatch::Cookies#call'
actionpack (8.1.2) lib/action_dispatch/middleware/callbacks.rb:31:in 'block in ActionDispatch::Callbacks#call'
activesupport (8.1.2) lib/active_support/callbacks.rb:101:in 'ActiveSupport::Callbacks#run_callbacks'
actionpack (8.1.2) lib/action_dispatch/middleware/callbacks.rb:30:in 'ActionDispatch::Callbacks#call'
actionpack (8.1.2) lib/action_dispatch/middleware/actionable_exceptions.rb:18:in 'ActionDispatch::ActionableExceptions#call'
actionpack (8.1.2) lib/action_dispatch/middleware/debug_exceptions.rb:31:in 'ActionDispatch::DebugExceptions#call'
actionpack (8.1.2) lib/action_dispatch/middleware/show_exceptions.rb:32:in 'ActionDispatch::ShowExceptions#call'
railties (8.1.2) lib/rails/rack/logger.rb:41:in 'Rails::Rack::Logger#call_app'
railties (8.1.2) lib/rails/rack/logger.rb:29:in 'Rails::Rack::Logger#call'
actionpack (8.1.2) lib/action_dispatch/middleware/remote_ip.rb:98:in 'ActionDispatch::RemoteIp#call'
actionpack (8.1.2) lib/action_dispatch/middleware/request_id.rb:34:in 'ActionDispatch::RequestId#call'
rack (3.2.4) lib/rack/method_override.rb:28:in 'Rack::MethodOverride#call'
rack (3.2.4) lib/rack/runtime.rb:24:in 'Rack::Runtime#call'
actionpack (8.1.2) lib/action_dispatch/middleware/executor.rb:20:in 'ActionDispatch::Executor#call'
actionpack (8.1.2) lib/action_dispatch/middleware/static.rb:27:in 'ActionDispatch::Static#call'
rack (3.2.4) lib/rack/sendfile.rb:131:in 'Rack::Sendfile#call'
railties (8.1.2) lib/rails/engine.rb:534:in 'Rails::Engine#call'
rack-test (2.2.0) lib/rack/test.rb:360:in 'Rack::Test::Session#process_request'
rack-test (2.2.0) lib/rack/test.rb:153:in 'Rack::Test::Session#request'
actionpack (8.1.2) lib/action_dispatch/testing/integration.rb:297:in 'ActionDispatch::Integration::Session#process'
actionpack (8.1.2) lib/action_dispatch/testing/integration.rb:25:in 'ActionDispatch::Integration::RequestHelpers#post'
actionpack (8.1.2) lib/action_dispatch/testing/integration.rb:388:in 'ActionDispatch::Integration::Runner#post'
/Users/bryanbeshore/Desktop/query_lens/test/controllers/queries_controller_test.rb:34:in 'block in <class:QueriesControllerTest>'
minitest (6.0.1) lib/minitest/test.rb:91:in 'block (2 levels) in Minitest::Test#run'
minitest (6.0.1) lib/minitest/test.rb:187:in 'Minitest::Test#capture_exceptions'
minitest (6.0.1) lib/minitest/test.rb:86:in 'block in Minitest::Test#run'
minitest (6.0.1) lib/minitest.rb:396:in 'Minitest::Runnable#time_it'
minitest (6.0.1) lib/minitest/test.rb:85:in 'Minitest::Test#run'
activesupport (8.1.2) lib/active_support/executor/test_helper.rb:5:in 'block in ActiveSupport::Executor::TestHelper#run'
activesupport (8.1.2) lib/active_support/execution_wrapper.rb:104:in 'ActiveSupport::ExecutionWrapper.perform'
activesupport (8.1.2) lib/active_support/executor/test_helper.rb:5:in 'ActiveSupport::Executor::TestHelper#run'
minitest (6.0.1) lib/minitest.rb:485:in 'Minitest::Runnable.run'
minitest (6.0.1) lib/minitest.rb:472:in 'block (2 levels) in Minitest::Runnable.run_suite'
minitest (6.0.1) lib/minitest.rb:468:in 'Array#each'
minitest (6.0.1) lib/minitest.rb:468:in 'block in Minitest::Runnable.run_suite'
minitest (6.0.1) lib/minitest.rb:510:in 'Minitest::Runnable.on_signal'
minitest (6.0.1) lib/minitest.rb:497:in 'Minitest::Runnable.with_info_handler'
minitest (6.0.1) lib/minitest.rb:467:in 'Minitest::Runnable.run_suite'
minitest (6.0.1) lib/minitest.rb:360:in 'block in Minitest.run_all_suites'
minitest (6.0.1) lib/minitest.rb:360:in 'Array#map'
minitest (6.0.1) lib/minitest.rb:360:in 'Minitest.run_all_suites'
minitest (6.0.1) lib/minitest.rb:315:in 'Minitest.run'
minitest (6.0.1) lib/minitest.rb:84:in 'block in Minitest.autorun'
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[31mROLLBACK TRANSACTION[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[36mBEGIN deferred TRANSACTION[0m
----------------------------------------------------------------------
QueryLens::QueriesControllerTest: test_execute_rejects_DROP_statements
----------------------------------------------------------------------
  [1m[35m (0.1ms)[0m  [1m[35mDROP TABLE IF EXISTS "users"[0m
  [1m[35m (0.1ms)[0m  [1m[35mCREATE TABLE "users" ("id" integer PRIMARY KEY AUTOINCREMENT NOT NULL, "name" varchar, "email" varchar, "created_at" datetime(6) NOT NULL, "updated_at" datetime(6) NOT NULL)[0m
  [1m[35m (0.0ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" varchar NOT NULL PRIMARY KEY)[0m
  [1m[35m (0.0ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" varchar NOT NULL PRIMARY KEY, "value" varchar, "created_at" datetime(6) NOT NULL, "updated_at" datetime(6) NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.0ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::InternalMetadata Create (0.0ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES ('environment', 'test', '2026-02-07 18:17:04.464537', '2026-02-07 18:17:04.464538') RETURNING "key"[0m
  [1m[35m (0.0ms)[0m  [1m[32mINSERT INTO users (name, email, created_at, updated_at) VALUES ('Alice', 'alice@example.com', datetime('now'), datetime('now'))[0m
  [1m[35m (0.0ms)[0m  [1m[32mINSERT INTO users (name, email, created_at, updated_at) VALUES ('Bob', 'bob@example.com', datetime('now'), datetime('now'))[0m
Started POST "/query_lens/execute" for 127.0.0.1 at 2026-02-07 13:17:04 -0500
Processing by QueryLens::QueriesController#execute as JSON
  Parameters: {"sql" => "DROP TABLE users", "query" => {"sql" => "DROP TABLE users"}}
Can't verify CSRF token authenticity.
Completed 422 Unprocessable Content in 0ms (ActiveRecord: 0.0ms (0 queries, 0 cached) | GC: 0.0ms)
  
ActionController::InvalidAuthenticityToken (Can't verify CSRF token authenticity.):
  
actionpack (8.1.2) lib/action_controller/metal/request_forgery_protection.rb:321:in 'ActionController::RequestForgeryProtection::ProtectionMethods::Exception#handle_unverified_request'
actionpack (8.1.2) lib/action_controller/metal/request_forgery_protection.rb:415:in 'ActionController::RequestForgeryProtection#handle_unverified_request'
actionpack (8.1.2) lib/action_controller/metal/request_forgery_protection.rb:404:in 'ActionController::RequestForgeryProtection#verify_authenticity_token'
activesupport (8.1.2) lib/active_support/callbacks.rb:362:in 'block in ActiveSupport::Callbacks::CallTemplate::MethodCall#make_lambda'
activesupport (8.1.2) lib/active_support/callbacks.rb:179:in 'block in ActiveSupport::Callbacks::Filters::Before#call'
actionpack (8.1.2) lib/abstract_controller/callbacks.rb:36:in 'block (2 levels) in <module:Callbacks>'
activesupport (8.1.2) lib/active_support/callbacks.rb:180:in 'ActiveSupport::Callbacks::Filters::Before#call'
activesupport (8.1.2) lib/active_support/callbacks.rb:560:in 'block in ActiveSupport::Callbacks::CallbackSequence#invoke_before'
activesupport (8.1.2) lib/active_support/callbacks.rb:560:in 'Array#each'
activesupport (8.1.2) lib/active_support/callbacks.rb:560:in 'ActiveSupport::Callbacks::CallbackSequence#invoke_before'
activesupport (8.1.2) lib/active_support/callbacks.rb:109:in 'ActiveSupport::Callbacks#run_callbacks'
actionpack (8.1.2) lib/abstract_controller/callbacks.rb:266:in 'AbstractController::Callbacks#process_action'
actionpack (8.1.2) lib/action_controller/metal/rescue.rb:36:in 'ActionController::Rescue#process_action'
actionpack (8.1.2) lib/action_controller/metal/instrumentation.rb:76:in 'block in ActionController::Instrumentation#process_action'
activesupport (8.1.2) lib/active_support/notifications.rb:210:in 'block in ActiveSupport::Notifications.instrument'
activesupport (8.1.2) lib/active_support/notifications/instrumenter.rb:58:in 'ActiveSupport::Notifications::Instrumenter#instrument'
activesupport (8.1.2) lib/active_support/notifications.rb:210:in 'ActiveSupport::Notifications.instrument'
actionpack (8.1.2) lib/action_controller/metal/instrumentation.rb:75:in 'ActionController::Instrumentation#process_action'
actionpack (8.1.2) lib/action_controller/metal/params_wrapper.rb:259:in 'ActionController::ParamsWrapper#process_action'
activerecord (8.1.2) lib/active_record/railties/controller_runtime.rb:39:in 'ActiveRecord::Railties::ControllerRuntime#process_action'
actionpack (8.1.2) lib/abstract_controller/base.rb:154:in 'AbstractController::Base#process'
actionview (8.1.2) lib/action_view/rendering.rb:40:in 'ActionView::Rendering#process'
actionpack (8.1.2) lib/action_controller/metal.rb:252:in 'ActionController::Metal#dispatch'
actionpack (8.1.2) lib/action_controller/metal.rb:335:in 'ActionController::Metal.dispatch'
actionpack (8.1.2) lib/action_dispatch/routing/route_set.rb:65:in 'ActionDispatch::Routing::RouteSet::Dispatcher#dispatch'
actionpack (8.1.2) lib/action_dispatch/routing/route_set.rb:50:in 'ActionDispatch::Routing::RouteSet::Dispatcher#serve'
actionpack (8.1.2) lib/action_dispatch/journey/router.rb:35:in 'block in ActionDispatch::Journey::Router#serve'
actionpack (8.1.2) lib/action_dispatch/journey/router.rb:86:in 'block in ActionDispatch::Journey::Router#recognize'
actionpack (8.1.2) lib/action_dispatch/journey/router.rb:66:in 'Array#each'
actionpack (8.1.2) lib/action_dispatch/journey/router.rb:66:in 'ActionDispatch::Journey::Router#recognize'
actionpack (8.1.2) lib/action_dispatch/journey/router.rb:31:in 'ActionDispatch::Journey::Router#serve'
actionpack (8.1.2) lib/action_dispatch/routing/route_set.rb:906:in 'ActionDispatch::Routing::RouteSet#call'
railties (8.1.2) lib/rails/engine/lazy_route_set.rb:60:in 'Rails::Engine::LazyRouteSet#call'
railties (8.1.2) lib/rails/engine.rb:534:in 'Rails::Engine#call'
railties (8.1.2) lib/rails/railtie.rb:225:in 'Kernel#public_send'
railties (8.1.2) lib/rails/railtie.rb:225:in 'Rails::Railtie.method_missing'
actionpack (8.1.2) lib/action_dispatch/routing/mapper.rb:33:in 'block in <class:Constraints>'
actionpack (8.1.2) lib/action_dispatch/routing/mapper.rb:62:in 'ActionDispatch::Routing::Mapper::Constraints#serve'
actionpack (8.1.2) lib/action_dispatch/journey/router.rb:35:in 'block in ActionDispatch::Journey::Router#serve'
actionpack (8.1.2) lib/action_dispatch/journey/router.rb:92:in 'block in ActionDispatch::Journey::Router#recognize'
actionpack (8.1.2) lib/action_dispatch/journey/router.rb:66:in 'Array#each'
actionpack (8.1.2) lib/action_dispatch/journey/router.rb:66:in 'ActionDispatch::Journey::Router#recognize'
actionpack (8.1.2) lib/action_dispatch/journey/router.rb:31:in 'ActionDispatch::Journey::Router#serve'
actionpack (8.1.2) lib/action_dispatch/routing/route_set.rb:906:in 'ActionDispatch::Routing::RouteSet#call'
railties (8.1.2) lib/rails/engine/lazy_route_set.rb:60:in 'Rails::Engine::LazyRouteSet#call'
rack (3.2.4) lib/rack/tempfile_reaper.rb:20:in 'Rack::TempfileReaper#call'
rack (3.2.4) lib/rack/etag.rb:29:in 'Rack::ETag#call'
rack (3.2.4) lib/rack/conditional_get.rb:44:in 'Rack::ConditionalGet#call'
rack (3.2.4) lib/rack/head.rb:15:in 'Rack::Head#call'
actionpack (8.1.2) lib/action_dispatch/http/content_security_policy.rb:38:in 'ActionDispatch::ContentSecurityPolicy::Middleware#call'
rack-session (2.1.1) lib/rack/session/abstract/id.rb:274:in 'Rack::Session::Abstract::Persisted#context'
rack-session (2.1.1) lib/rack/session/abstract/id.rb:268:in 'Rack::Session::Abstract::Persisted#call'
actionpack (8.1.2) lib/action_dispatch/middleware/cookies.rb:708:in 'ActionDispatch::Cookies#call'
actionpack (8.1.2) lib/action_dispatch/middleware/callbacks.rb:31:in 'block in ActionDispatch::Callbacks#call'
activesupport (8.1.2) lib/active_support/callbacks.rb:101:in 'ActiveSupport::Callbacks#run_callbacks'
actionpack (8.1.2) lib/action_dispatch/middleware/callbacks.rb:30:in 'ActionDispatch::Callbacks#call'
actionpack (8.1.2) lib/action_dispatch/middleware/actionable_exceptions.rb:18:in 'ActionDispatch::ActionableExceptions#call'
actionpack (8.1.2) lib/action_dispatch/middleware/debug_exceptions.rb:31:in 'ActionDispatch::DebugExceptions#call'
actionpack (8.1.2) lib/action_dispatch/middleware/show_exceptions.rb:32:in 'ActionDispatch::ShowExceptions#call'
railties (8.1.2) lib/rails/rack/logger.rb:41:in 'Rails::Rack::Logger#call_app'
railties (8.1.2) lib/rails/rack/logger.rb:29:in 'Rails::Rack::Logger#call'
actionpack (8.1.2) lib/action_dispatch/middleware/remote_ip.rb:98:in 'ActionDispatch::RemoteIp#call'
actionpack (8.1.2) lib/action_dispatch/middleware/request_id.rb:34:in 'ActionDispatch::RequestId#call'
rack (3.2.4) lib/rack/method_override.rb:28:in 'Rack::MethodOverride#call'
rack (3.2.4) lib/rack/runtime.rb:24:in 'Rack::Runtime#call'
actionpack (8.1.2) lib/action_dispatch/middleware/executor.rb:20:in 'ActionDispatch::Executor#call'
actionpack (8.1.2) lib/action_dispatch/middleware/static.rb:27:in 'ActionDispatch::Static#call'
rack (3.2.4) lib/rack/sendfile.rb:131:in 'Rack::Sendfile#call'
railties (8.1.2) lib/rails/engine.rb:534:in 'Rails::Engine#call'
rack-test (2.2.0) lib/rack/test.rb:360:in 'Rack::Test::Session#process_request'
rack-test (2.2.0) lib/rack/test.rb:153:in 'Rack::Test::Session#request'
actionpack (8.1.2) lib/action_dispatch/testing/integration.rb:297:in 'ActionDispatch::Integration::Session#process'
actionpack (8.1.2) lib/action_dispatch/testing/integration.rb:25:in 'ActionDispatch::Integration::RequestHelpers#post'
actionpack (8.1.2) lib/action_dispatch/testing/integration.rb:388:in 'ActionDispatch::Integration::Runner#post'
/Users/bryanbeshore/Desktop/query_lens/test/controllers/queries_controller_test.rb:52:in 'block in <class:QueriesControllerTest>'
minitest (6.0.1) lib/minitest/test.rb:91:in 'block (2 levels) in Minitest::Test#run'
minitest (6.0.1) lib/minitest/test.rb:187:in 'Minitest::Test#capture_exceptions'
minitest (6.0.1) lib/minitest/test.rb:86:in 'block in Minitest::Test#run'
minitest (6.0.1) lib/minitest.rb:396:in 'Minitest::Runnable#time_it'
minitest (6.0.1) lib/minitest/test.rb:85:in 'Minitest::Test#run'
activesupport (8.1.2) lib/active_support/executor/test_helper.rb:5:in 'block in ActiveSupport::Executor::TestHelper#run'
activesupport (8.1.2) lib/active_support/execution_wrapper.rb:104:in 'ActiveSupport::ExecutionWrapper.perform'
activesupport (8.1.2) lib/active_support/executor/test_helper.rb:5:in 'ActiveSupport::Executor::TestHelper#run'
minitest (6.0.1) lib/minitest.rb:485:in 'Minitest::Runnable.run'
minitest (6.0.1) lib/minitest.rb:472:in 'block (2 levels) in Minitest::Runnable.run_suite'
minitest (6.0.1) lib/minitest.rb:468:in 'Array#each'
minitest (6.0.1) lib/minitest.rb:468:in 'block in Minitest::Runnable.run_suite'
minitest (6.0.1) lib/minitest.rb:510:in 'Minitest::Runnable.on_signal'
minitest (6.0.1) lib/minitest.rb:497:in 'Minitest::Runnable.with_info_handler'
minitest (6.0.1) lib/minitest.rb:467:in 'Minitest::Runnable.run_suite'
minitest (6.0.1) lib/minitest.rb:360:in 'block in Minitest.run_all_suites'
minitest (6.0.1) lib/minitest.rb:360:in 'Array#map'
minitest (6.0.1) lib/minitest.rb:360:in 'Minitest.run_all_suites'
minitest (6.0.1) lib/minitest.rb:315:in 'Minitest.run'
minitest (6.0.1) lib/minitest.rb:84:in 'block in Minitest.autorun'
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK TRANSACTION[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[36mBEGIN deferred TRANSACTION[0m
------------------------------------------------------------------------
QueryLens::QueriesControllerTest: test_execute_rejects_UPDATE_statements
------------------------------------------------------------------------
  [1m[35m (0.1ms)[0m  [1m[35mDROP TABLE IF EXISTS "users"[0m
  [1m[35m (0.1ms)[0m  [1m[35mCREATE TABLE "users" ("id" integer PRIMARY KEY AUTOINCREMENT NOT NULL, "name" varchar, "email" varchar, "created_at" datetime(6) NOT NULL, "updated_at" datetime(6) NOT NULL)[0m
  [1m[35m (0.0ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" varchar NOT NULL PRIMARY KEY)[0m
  [1m[35m (0.0ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" varchar NOT NULL PRIMARY KEY, "value" varchar, "created_at" datetime(6) NOT NULL, "updated_at" datetime(6) NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.0ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::InternalMetadata Create (0.0ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES ('environment', 'test', '2026-02-07 18:17:04.564623', '2026-02-07 18:17:04.564625') RETURNING "key"[0m
  [1m[35m (0.0ms)[0m  [1m[32mINSERT INTO users (name, email, created_at, updated_at) VALUES ('Alice', 'alice@example.com', datetime('now'), datetime('now'))[0m
  [1m[35m (0.0ms)[0m  [1m[32mINSERT INTO users (name, email, created_at, updated_at) VALUES ('Bob', 'bob@example.com', datetime('now'), datetime('now'))[0m
Started POST "/query_lens/execute" for 127.0.0.1 at 2026-02-07 13:17:04 -0500
Processing by QueryLens::QueriesController#execute as JSON
  Parameters: {"sql" => "UPDATE users SET name = 'hacked'", "query" => {"sql" => "UPDATE users SET name = 'hacked'"}}
Can't verify CSRF token authenticity.
Completed 422 Unprocessable Content in 0ms (ActiveRecord: 0.0ms (0 queries, 0 cached) | GC: 0.0ms)
  
ActionController::InvalidAuthenticityToken (Can't verify CSRF token authenticity.):
  
actionpack (8.1.2) lib/action_controller/metal/request_forgery_protection.rb:321:in 'ActionController::RequestForgeryProtection::ProtectionMethods::Exception#handle_unverified_request'
actionpack (8.1.2) lib/action_controller/metal/request_forgery_protection.rb:415:in 'ActionController::RequestForgeryProtection#handle_unverified_request'
actionpack (8.1.2) lib/action_controller/metal/request_forgery_protection.rb:404:in 'ActionController::RequestForgeryProtection#verify_authenticity_token'
activesupport (8.1.2) lib/active_support/callbacks.rb:362:in 'block in ActiveSupport::Callbacks::CallTemplate::MethodCall#make_lambda'
activesupport (8.1.2) lib/active_support/callbacks.rb:179:in 'block in ActiveSupport::Callbacks::Filters::Before#call'
actionpack (8.1.2) lib/abstract_controller/callbacks.rb:36:in 'block (2 levels) in <module:Callbacks>'
activesupport (8.1.2) lib/active_support/callbacks.rb:180:in 'ActiveSupport::Callbacks::Filters::Before#call'
activesupport (8.1.2) lib/active_support/callbacks.rb:560:in 'block in ActiveSupport::Callbacks::CallbackSequence#invoke_before'
activesupport (8.1.2) lib/active_support/callbacks.rb:560:in 'Array#each'
activesupport (8.1.2) lib/active_support/callbacks.rb:560:in 'ActiveSupport::Callbacks::CallbackSequence#invoke_before'
activesupport (8.1.2) lib/active_support/callbacks.rb:109:in 'ActiveSupport::Callbacks#run_callbacks'
actionpack (8.1.2) lib/abstract_controller/callbacks.rb:266:in 'AbstractController::Callbacks#process_action'
actionpack (8.1.2) lib/action_controller/metal/rescue.rb:36:in 'ActionController::Rescue#process_action'
actionpack (8.1.2) lib/action_controller/metal/instrumentation.rb:76:in 'block in ActionController::Instrumentation#process_action'
activesupport (8.1.2) lib/active_support/notifications.rb:210:in 'block in ActiveSupport::Notifications.instrument'
activesupport (8.1.2) lib/active_support/notifications/instrumenter.rb:58:in 'ActiveSupport::Notifications::Instrumenter#instrument'
activesupport (8.1.2) lib/active_support/notifications.rb:210:in 'ActiveSupport::Notifications.instrument'
actionpack (8.1.2) lib/action_controller/metal/instrumentation.rb:75:in 'ActionController::Instrumentation#process_action'
actionpack (8.1.2) lib/action_controller/metal/params_wrapper.rb:259:in 'ActionController::ParamsWrapper#process_action'
activerecord (8.1.2) lib/active_record/railties/controller_runtime.rb:39:in 'ActiveRecord::Railties::ControllerRuntime#process_action'
actionpack (8.1.2) lib/abstract_controller/base.rb:154:in 'AbstractController::Base#process'
actionview (8.1.2) lib/action_view/rendering.rb:40:in 'ActionView::Rendering#process'
actionpack (8.1.2) lib/action_controller/metal.rb:252:in 'ActionController::Metal#dispatch'
actionpack (8.1.2) lib/action_controller/metal.rb:335:in 'ActionController::Metal.dispatch'
actionpack (8.1.2) lib/action_dispatch/routing/route_set.rb:65:in 'ActionDispatch::Routing::RouteSet::Dispatcher#dispatch'
actionpack (8.1.2) lib/action_dispatch/routing/route_set.rb:50:in 'ActionDispatch::Routing::RouteSet::Dispatcher#serve'
actionpack (8.1.2) lib/action_dispatch/journey/router.rb:35:in 'block in ActionDispatch::Journey::Router#serve'
actionpack (8.1.2) lib/action_dispatch/journey/router.rb:86:in 'block in ActionDispatch::Journey::Router#recognize'
actionpack (8.1.2) lib/action_dispatch/journey/router.rb:66:in 'Array#each'
actionpack (8.1.2) lib/action_dispatch/journey/router.rb:66:in 'ActionDispatch::Journey::Router#recognize'
actionpack (8.1.2) lib/action_dispatch/journey/router.rb:31:in 'ActionDispatch::Journey::Router#serve'
actionpack (8.1.2) lib/action_dispatch/routing/route_set.rb:906:in 'ActionDispatch::Routing::RouteSet#call'
railties (8.1.2) lib/rails/engine/lazy_route_set.rb:60:in 'Rails::Engine::LazyRouteSet#call'
railties (8.1.2) lib/rails/engine.rb:534:in 'Rails::Engine#call'
railties (8.1.2) lib/rails/railtie.rb:225:in 'Kernel#public_send'
railties (8.1.2) lib/rails/railtie.rb:225:in 'Rails::Railtie.method_missing'
actionpack (8.1.2) lib/action_dispatch/routing/mapper.rb:33:in 'block in <class:Constraints>'
actionpack (8.1.2) lib/action_dispatch/routing/mapper.rb:62:in 'ActionDispatch::Routing::Mapper::Constraints#serve'
actionpack (8.1.2) lib/action_dispatch/journey/router.rb:35:in 'block in ActionDispatch::Journey::Router#serve'
actionpack (8.1.2) lib/action_dispatch/journey/router.rb:92:in 'block in ActionDispatch::Journey::Router#recognize'
actionpack (8.1.2) lib/action_dispatch/journey/router.rb:66:in 'Array#each'
actionpack (8.1.2) lib/action_dispatch/journey/router.rb:66:in 'ActionDispatch::Journey::Router#recognize'
actionpack (8.1.2) lib/action_dispatch/journey/router.rb:31:in 'ActionDispatch::Journey::Router#serve'
actionpack (8.1.2) lib/action_dispatch/routing/route_set.rb:906:in 'ActionDispatch::Routing::RouteSet#call'
railties (8.1.2) lib/rails/engine/lazy_route_set.rb:60:in 'Rails::Engine::LazyRouteSet#call'
rack (3.2.4) lib/rack/tempfile_reaper.rb:20:in 'Rack::TempfileReaper#call'
rack (3.2.4) lib/rack/etag.rb:29:in 'Rack::ETag#call'
rack (3.2.4) lib/rack/conditional_get.rb:44:in 'Rack::ConditionalGet#call'
rack (3.2.4) lib/rack/head.rb:15:in 'Rack::Head#call'
actionpack (8.1.2) lib/action_dispatch/http/content_security_policy.rb:38:in 'ActionDispatch::ContentSecurityPolicy::Middleware#call'
rack-session (2.1.1) lib/rack/session/abstract/id.rb:274:in 'Rack::Session::Abstract::Persisted#context'
rack-session (2.1.1) lib/rack/session/abstract/id.rb:268:in 'Rack::Session::Abstract::Persisted#call'
actionpack (8.1.2) lib/action_dispatch/middleware/cookies.rb:708:in 'ActionDispatch::Cookies#call'
actionpack (8.1.2) lib/action_dispatch/middleware/callbacks.rb:31:in 'block in ActionDispatch::Callbacks#call'
activesupport (8.1.2) lib/active_support/callbacks.rb:101:in 'ActiveSupport::Callbacks#run_callbacks'
actionpack (8.1.2) lib/action_dispatch/middleware/callbacks.rb:30:in 'ActionDispatch::Callbacks#call'
actionpack (8.1.2) lib/action_dispatch/middleware/actionable_exceptions.rb:18:in 'ActionDispatch::ActionableExceptions#call'
actionpack (8.1.2) lib/action_dispatch/middleware/debug_exceptions.rb:31:in 'ActionDispatch::DebugExceptions#call'
actionpack (8.1.2) lib/action_dispatch/middleware/show_exceptions.rb:32:in 'ActionDispatch::ShowExceptions#call'
railties (8.1.2) lib/rails/rack/logger.rb:41:in 'Rails::Rack::Logger#call_app'
railties (8.1.2) lib/rails/rack/logger.rb:29:in 'Rails::Rack::Logger#call'
actionpack (8.1.2) lib/action_dispatch/middleware/remote_ip.rb:98:in 'ActionDispatch::RemoteIp#call'
actionpack (8.1.2) lib/action_dispatch/middleware/request_id.rb:34:in 'ActionDispatch::RequestId#call'
rack (3.2.4) lib/rack/method_override.rb:28:in 'Rack::MethodOverride#call'
rack (3.2.4) lib/rack/runtime.rb:24:in 'Rack::Runtime#call'
actionpack (8.1.2) lib/action_dispatch/middleware/executor.rb:20:in 'ActionDispatch::Executor#call'
actionpack (8.1.2) lib/action_dispatch/middleware/static.rb:27:in 'ActionDispatch::Static#call'
rack (3.2.4) lib/rack/sendfile.rb:131:in 'Rack::Sendfile#call'
railties (8.1.2) lib/rails/engine.rb:534:in 'Rails::Engine#call'
rack-test (2.2.0) lib/rack/test.rb:360:in 'Rack::Test::Session#process_request'
rack-test (2.2.0) lib/rack/test.rb:153:in 'Rack::Test::Session#request'
actionpack (8.1.2) lib/action_dispatch/testing/integration.rb:297:in 'ActionDispatch::Integration::Session#process'
actionpack (8.1.2) lib/action_dispatch/testing/integration.rb:25:in 'ActionDispatch::Integration::RequestHelpers#post'
actionpack (8.1.2) lib/action_dispatch/testing/integration.rb:388:in 'ActionDispatch::Integration::Runner#post'
/Users/bryanbeshore/Desktop/query_lens/test/controllers/queries_controller_test.rb:47:in 'block in <class:QueriesControllerTest>'
minitest (6.0.1) lib/minitest/test.rb:91:in 'block (2 levels) in Minitest::Test#run'
minitest (6.0.1) lib/minitest/test.rb:187:in 'Minitest::Test#capture_exceptions'
minitest (6.0.1) lib/minitest/test.rb:86:in 'block in Minitest::Test#run'
minitest (6.0.1) lib/minitest.rb:396:in 'Minitest::Runnable#time_it'
minitest (6.0.1) lib/minitest/test.rb:85:in 'Minitest::Test#run'
activesupport (8.1.2) lib/active_support/executor/test_helper.rb:5:in 'block in ActiveSupport::Executor::TestHelper#run'
activesupport (8.1.2) lib/active_support/execution_wrapper.rb:104:in 'ActiveSupport::ExecutionWrapper.perform'
activesupport (8.1.2) lib/active_support/executor/test_helper.rb:5:in 'ActiveSupport::Executor::TestHelper#run'
minitest (6.0.1) lib/minitest.rb:485:in 'Minitest::Runnable.run'
minitest (6.0.1) lib/minitest.rb:472:in 'block (2 levels) in Minitest::Runnable.run_suite'
minitest (6.0.1) lib/minitest.rb:468:in 'Array#each'
minitest (6.0.1) lib/minitest.rb:468:in 'block in Minitest::Runnable.run_suite'
minitest (6.0.1) lib/minitest.rb:510:in 'Minitest::Runnable.on_signal'
minitest (6.0.1) lib/minitest.rb:497:in 'Minitest::Runnable.with_info_handler'
minitest (6.0.1) lib/minitest.rb:467:in 'Minitest::Runnable.run_suite'
minitest (6.0.1) lib/minitest.rb:360:in 'block in Minitest.run_all_suites'
minitest (6.0.1) lib/minitest.rb:360:in 'Array#map'
minitest (6.0.1) lib/minitest.rb:360:in 'Minitest.run_all_suites'
minitest (6.0.1) lib/minitest.rb:315:in 'Minitest.run'
minitest (6.0.1) lib/minitest.rb:84:in 'block in Minitest.autorun'
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[31mROLLBACK TRANSACTION[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[36mBEGIN deferred TRANSACTION[0m
----------------------------------------------------------------------------
QueryLens::QueriesControllerTest: test_execute_handles_SQL_errors_gracefully
----------------------------------------------------------------------------
  [1m[35m (0.1ms)[0m  [1m[35mDROP TABLE IF EXISTS "users"[0m
  [1m[35m (0.1ms)[0m  [1m[35mCREATE TABLE "users" ("id" integer PRIMARY KEY AUTOINCREMENT NOT NULL, "name" varchar, "email" varchar, "created_at" datetime(6) NOT NULL, "updated_at" datetime(6) NOT NULL)[0m
  [1m[35m (0.0ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" varchar NOT NULL PRIMARY KEY)[0m
  [1m[35m (0.0ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" varchar NOT NULL PRIMARY KEY, "value" varchar, "created_at" datetime(6) NOT NULL, "updated_at" datetime(6) NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.0ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::InternalMetadata Create (0.0ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES ('environment', 'test', '2026-02-07 18:17:04.642520', '2026-02-07 18:17:04.642521') RETURNING "key"[0m
  [1m[35m (0.0ms)[0m  [1m[32mINSERT INTO users (name, email, created_at, updated_at) VALUES ('Alice', 'alice@example.com', datetime('now'), datetime('now'))[0m
  [1m[35m (0.0ms)[0m  [1m[32mINSERT INTO users (name, email, created_at, updated_at) VALUES ('Bob', 'bob@example.com', datetime('now'), datetime('now'))[0m
Started POST "/query_lens/execute" for 127.0.0.1 at 2026-02-07 13:17:04 -0500
Processing by QueryLens::QueriesController#execute as JSON
  Parameters: {"sql" => "SELECT * FROM nonexistent_table", "query" => {"sql" => "SELECT * FROM nonexistent_table"}}
Can't verify CSRF token authenticity.
Completed 422 Unprocessable Content in 0ms (ActiveRecord: 0.0ms (0 queries, 0 cached) | GC: 0.0ms)
  
ActionController::InvalidAuthenticityToken (Can't verify CSRF token authenticity.):
  
actionpack (8.1.2) lib/action_controller/metal/request_forgery_protection.rb:321:in 'ActionController::RequestForgeryProtection::ProtectionMethods::Exception#handle_unverified_request'
actionpack (8.1.2) lib/action_controller/metal/request_forgery_protection.rb:415:in 'ActionController::RequestForgeryProtection#handle_unverified_request'
actionpack (8.1.2) lib/action_controller/metal/request_forgery_protection.rb:404:in 'ActionController::RequestForgeryProtection#verify_authenticity_token'
activesupport (8.1.2) lib/active_support/callbacks.rb:362:in 'block in ActiveSupport::Callbacks::CallTemplate::MethodCall#make_lambda'
activesupport (8.1.2) lib/active_support/callbacks.rb:179:in 'block in ActiveSupport::Callbacks::Filters::Before#call'
actionpack (8.1.2) lib/abstract_controller/callbacks.rb:36:in 'block (2 levels) in <module:Callbacks>'
activesupport (8.1.2) lib/active_support/callbacks.rb:180:in 'ActiveSupport::Callbacks::Filters::Before#call'
activesupport (8.1.2) lib/active_support/callbacks.rb:560:in 'block in ActiveSupport::Callbacks::CallbackSequence#invoke_before'
activesupport (8.1.2) lib/active_support/callbacks.rb:560:in 'Array#each'
activesupport (8.1.2) lib/active_support/callbacks.rb:560:in 'ActiveSupport::Callbacks::CallbackSequence#invoke_before'
activesupport (8.1.2) lib/active_support/callbacks.rb:109:in 'ActiveSupport::Callbacks#run_callbacks'
actionpack (8.1.2) lib/abstract_controller/callbacks.rb:266:in 'AbstractController::Callbacks#process_action'
actionpack (8.1.2) lib/action_controller/metal/rescue.rb:36:in 'ActionController::Rescue#process_action'
actionpack (8.1.2) lib/action_controller/metal/instrumentation.rb:76:in 'block in ActionController::Instrumentation#process_action'
activesupport (8.1.2) lib/active_support/notifications.rb:210:in 'block in ActiveSupport::Notifications.instrument'
activesupport (8.1.2) lib/active_support/notifications/instrumenter.rb:58:in 'ActiveSupport::Notifications::Instrumenter#instrument'
activesupport (8.1.2) lib/active_support/notifications.rb:210:in 'ActiveSupport::Notifications.instrument'
actionpack (8.1.2) lib/action_controller/metal/instrumentation.rb:75:in 'ActionController::Instrumentation#process_action'
actionpack (8.1.2) lib/action_controller/metal/params_wrapper.rb:259:in 'ActionController::ParamsWrapper#process_action'
activerecord (8.1.2) lib/active_record/railties/controller_runtime.rb:39:in 'ActiveRecord::Railties::ControllerRuntime#process_action'
actionpack (8.1.2) lib/abstract_controller/base.rb:154:in 'AbstractController::Base#process'
actionview (8.1.2) lib/action_view/rendering.rb:40:in 'ActionView::Rendering#process'
actionpack (8.1.2) lib/action_controller/metal.rb:252:in 'ActionController::Metal#dispatch'
actionpack (8.1.2) lib/action_controller/metal.rb:335:in 'ActionController::Metal.dispatch'
actionpack (8.1.2) lib/action_dispatch/routing/route_set.rb:65:in 'ActionDispatch::Routing::RouteSet::Dispatcher#dispatch'
actionpack (8.1.2) lib/action_dispatch/routing/route_set.rb:50:in 'ActionDispatch::Routing::RouteSet::Dispatcher#serve'
actionpack (8.1.2) lib/action_dispatch/journey/router.rb:35:in 'block in ActionDispatch::Journey::Router#serve'
actionpack (8.1.2) lib/action_dispatch/journey/router.rb:86:in 'block in ActionDispatch::Journey::Router#recognize'
actionpack (8.1.2) lib/action_dispatch/journey/router.rb:66:in 'Array#each'
actionpack (8.1.2) lib/action_dispatch/journey/router.rb:66:in 'ActionDispatch::Journey::Router#recognize'
actionpack (8.1.2) lib/action_dispatch/journey/router.rb:31:in 'ActionDispatch::Journey::Router#serve'
actionpack (8.1.2) lib/action_dispatch/routing/route_set.rb:906:in 'ActionDispatch::Routing::RouteSet#call'
railties (8.1.2) lib/rails/engine/lazy_route_set.rb:60:in 'Rails::Engine::LazyRouteSet#call'
railties (8.1.2) lib/rails/engine.rb:534:in 'Rails::Engine#call'
railties (8.1.2) lib/rails/railtie.rb:225:in 'Kernel#public_send'
railties (8.1.2) lib/rails/railtie.rb:225:in 'Rails::Railtie.method_missing'
actionpack (8.1.2) lib/action_dispatch/routing/mapper.rb:33:in 'block in <class:Constraints>'
actionpack (8.1.2) lib/action_dispatch/routing/mapper.rb:62:in 'ActionDispatch::Routing::Mapper::Constraints#serve'
actionpack (8.1.2) lib/action_dispatch/journey/router.rb:35:in 'block in ActionDispatch::Journey::Router#serve'
actionpack (8.1.2) lib/action_dispatch/journey/router.rb:92:in 'block in ActionDispatch::Journey::Router#recognize'
actionpack (8.1.2) lib/action_dispatch/journey/router.rb:66:in 'Array#each'
actionpack (8.1.2) lib/action_dispatch/journey/router.rb:66:in 'ActionDispatch::Journey::Router#recognize'
actionpack (8.1.2) lib/action_dispatch/journey/router.rb:31:in 'ActionDispatch::Journey::Router#serve'
actionpack (8.1.2) lib/action_dispatch/routing/route_set.rb:906:in 'ActionDispatch::Routing::RouteSet#call'
railties (8.1.2) lib/rails/engine/lazy_route_set.rb:60:in 'Rails::Engine::LazyRouteSet#call'
rack (3.2.4) lib/rack/tempfile_reaper.rb:20:in 'Rack::TempfileReaper#call'
rack (3.2.4) lib/rack/etag.rb:29:in 'Rack::ETag#call'
rack (3.2.4) lib/rack/conditional_get.rb:44:in 'Rack::ConditionalGet#call'
rack (3.2.4) lib/rack/head.rb:15:in 'Rack::Head#call'
actionpack (8.1.2) lib/action_dispatch/http/content_security_policy.rb:38:in 'ActionDispatch::ContentSecurityPolicy::Middleware#call'
rack-session (2.1.1) lib/rack/session/abstract/id.rb:274:in 'Rack::Session::Abstract::Persisted#context'
rack-session (2.1.1) lib/rack/session/abstract/id.rb:268:in 'Rack::Session::Abstract::Persisted#call'
actionpack (8.1.2) lib/action_dispatch/middleware/cookies.rb:708:in 'ActionDispatch::Cookies#call'
actionpack (8.1.2) lib/action_dispatch/middleware/callbacks.rb:31:in 'block in ActionDispatch::Callbacks#call'
activesupport (8.1.2) lib/active_support/callbacks.rb:101:in 'ActiveSupport::Callbacks#run_callbacks'
actionpack (8.1.2) lib/action_dispatch/middleware/callbacks.rb:30:in 'ActionDispatch::Callbacks#call'
actionpack (8.1.2) lib/action_dispatch/middleware/actionable_exceptions.rb:18:in 'ActionDispatch::ActionableExceptions#call'
actionpack (8.1.2) lib/action_dispatch/middleware/debug_exceptions.rb:31:in 'ActionDispatch::DebugExceptions#call'
actionpack (8.1.2) lib/action_dispatch/middleware/show_exceptions.rb:32:in 'ActionDispatch::ShowExceptions#call'
railties (8.1.2) lib/rails/rack/logger.rb:41:in 'Rails::Rack::Logger#call_app'
railties (8.1.2) lib/rails/rack/logger.rb:29:in 'Rails::Rack::Logger#call'
actionpack (8.1.2) lib/action_dispatch/middleware/remote_ip.rb:98:in 'ActionDispatch::RemoteIp#call'
actionpack (8.1.2) lib/action_dispatch/middleware/request_id.rb:34:in 'ActionDispatch::RequestId#call'
rack (3.2.4) lib/rack/method_override.rb:28:in 'Rack::MethodOverride#call'
rack (3.2.4) lib/rack/runtime.rb:24:in 'Rack::Runtime#call'
actionpack (8.1.2) lib/action_dispatch/middleware/executor.rb:20:in 'ActionDispatch::Executor#call'
actionpack (8.1.2) lib/action_dispatch/middleware/static.rb:27:in 'ActionDispatch::Static#call'
rack (3.2.4) lib/rack/sendfile.rb:131:in 'Rack::Sendfile#call'
railties (8.1.2) lib/rails/engine.rb:534:in 'Rails::Engine#call'
rack-test (2.2.0) lib/rack/test.rb:360:in 'Rack::Test::Session#process_request'
rack-test (2.2.0) lib/rack/test.rb:153:in 'Rack::Test::Session#request'
actionpack (8.1.2) lib/action_dispatch/testing/integration.rb:297:in 'ActionDispatch::Integration::Session#process'
actionpack (8.1.2) lib/action_dispatch/testing/integration.rb:25:in 'ActionDispatch::Integration::RequestHelpers#post'
actionpack (8.1.2) lib/action_dispatch/testing/integration.rb:388:in 'ActionDispatch::Integration::Runner#post'
/Users/bryanbeshore/Desktop/query_lens/test/controllers/queries_controller_test.rb:62:in 'block in <class:QueriesControllerTest>'
minitest (6.0.1) lib/minitest/test.rb:91:in 'block (2 levels) in Minitest::Test#run'
minitest (6.0.1) lib/minitest/test.rb:187:in 'Minitest::Test#capture_exceptions'
minitest (6.0.1) lib/minitest/test.rb:86:in 'block in Minitest::Test#run'
minitest (6.0.1) lib/minitest.rb:396:in 'Minitest::Runnable#time_it'
minitest (6.0.1) lib/minitest/test.rb:85:in 'Minitest::Test#run'
activesupport (8.1.2) lib/active_support/executor/test_helper.rb:5:in 'block in ActiveSupport::Executor::TestHelper#run'
activesupport (8.1.2) lib/active_support/execution_wrapper.rb:104:in 'ActiveSupport::ExecutionWrapper.perform'
activesupport (8.1.2) lib/active_support/executor/test_helper.rb:5:in 'ActiveSupport::Executor::TestHelper#run'
minitest (6.0.1) lib/minitest.rb:485:in 'Minitest::Runnable.run'
minitest (6.0.1) lib/minitest.rb:472:in 'block (2 levels) in Minitest::Runnable.run_suite'
minitest (6.0.1) lib/minitest.rb:468:in 'Array#each'
minitest (6.0.1) lib/minitest.rb:468:in 'block in Minitest::Runnable.run_suite'
minitest (6.0.1) lib/minitest.rb:510:in 'Minitest::Runnable.on_signal'
minitest (6.0.1) lib/minitest.rb:497:in 'Minitest::Runnable.with_info_handler'
minitest (6.0.1) lib/minitest.rb:467:in 'Minitest::Runnable.run_suite'
minitest (6.0.1) lib/minitest.rb:360:in 'block in Minitest.run_all_suites'
minitest (6.0.1) lib/minitest.rb:360:in 'Array#map'
minitest (6.0.1) lib/minitest.rb:360:in 'Minitest.run_all_suites'
minitest (6.0.1) lib/minitest.rb:315:in 'Minitest.run'
minitest (6.0.1) lib/minitest.rb:84:in 'block in Minitest.autorun'
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[31mROLLBACK TRANSACTION[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[36mBEGIN deferred TRANSACTION[0m
----------------------------------------------------------------------------------
QueryLens::QueriesControllerTest: test_execute_rejects_SELECT_with_embedded_DELETE
----------------------------------------------------------------------------------
  [1m[35m (0.0ms)[0m  [1m[35mDROP TABLE IF EXISTS "users"[0m
  [1m[35m (0.1ms)[0m  [1m[35mCREATE TABLE "users" ("id" integer PRIMARY KEY AUTOINCREMENT NOT NULL, "name" varchar, "email" varchar, "created_at" datetime(6) NOT NULL, "updated_at" datetime(6) NOT NULL)[0m
  [1m[35m (0.0ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" varchar NOT NULL PRIMARY KEY)[0m
  [1m[35m (0.0ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" varchar NOT NULL PRIMARY KEY, "value" varchar, "created_at" datetime(6) NOT NULL, "updated_at" datetime(6) NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.0ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::InternalMetadata Create (0.0ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES ('environment', 'test', '2026-02-07 18:17:04.721922', '2026-02-07 18:17:04.721924') RETURNING "key"[0m
  [1m[35m (0.0ms)[0m  [1m[32mINSERT INTO users (name, email, created_at, updated_at) VALUES ('Alice', 'alice@example.com', datetime('now'), datetime('now'))[0m
  [1m[35m (0.0ms)[0m  [1m[32mINSERT INTO users (name, email, created_at, updated_at) VALUES ('Bob', 'bob@example.com', datetime('now'), datetime('now'))[0m
Started POST "/query_lens/execute" for 127.0.0.1 at 2026-02-07 13:17:04 -0500
Processing by QueryLens::QueriesController#execute as JSON
  Parameters: {"sql" => "SELECT 1; DELETE FROM users", "query" => {"sql" => "SELECT 1; DELETE FROM users"}}
Can't verify CSRF token authenticity.
Completed 422 Unprocessable Content in 0ms (ActiveRecord: 0.0ms (0 queries, 0 cached) | GC: 0.1ms)
  
ActionController::InvalidAuthenticityToken (Can't verify CSRF token authenticity.):
  
actionpack (8.1.2) lib/action_controller/metal/request_forgery_protection.rb:321:in 'ActionController::RequestForgeryProtection::ProtectionMethods::Exception#handle_unverified_request'
actionpack (8.1.2) lib/action_controller/metal/request_forgery_protection.rb:415:in 'ActionController::RequestForgeryProtection#handle_unverified_request'
actionpack (8.1.2) lib/action_controller/metal/request_forgery_protection.rb:404:in 'ActionController::RequestForgeryProtection#verify_authenticity_token'
activesupport (8.1.2) lib/active_support/callbacks.rb:362:in 'block in ActiveSupport::Callbacks::CallTemplate::MethodCall#make_lambda'
activesupport (8.1.2) lib/active_support/callbacks.rb:179:in 'block in ActiveSupport::Callbacks::Filters::Before#call'
actionpack (8.1.2) lib/abstract_controller/callbacks.rb:36:in 'block (2 levels) in <module:Callbacks>'
activesupport (8.1.2) lib/active_support/callbacks.rb:180:in 'ActiveSupport::Callbacks::Filters::Before#call'
activesupport (8.1.2) lib/active_support/callbacks.rb:560:in 'block in ActiveSupport::Callbacks::CallbackSequence#invoke_before'
activesupport (8.1.2) lib/active_support/callbacks.rb:560:in 'Array#each'
activesupport (8.1.2) lib/active_support/callbacks.rb:560:in 'ActiveSupport::Callbacks::CallbackSequence#invoke_before'
activesupport (8.1.2) lib/active_support/callbacks.rb:109:in 'ActiveSupport::Callbacks#run_callbacks'
actionpack (8.1.2) lib/abstract_controller/callbacks.rb:266:in 'AbstractController::Callbacks#process_action'
actionpack (8.1.2) lib/action_controller/metal/rescue.rb:36:in 'ActionController::Rescue#process_action'
actionpack (8.1.2) lib/action_controller/metal/instrumentation.rb:76:in 'block in ActionController::Instrumentation#process_action'
activesupport (8.1.2) lib/active_support/notifications.rb:210:in 'block in ActiveSupport::Notifications.instrument'
activesupport (8.1.2) lib/active_support/notifications/instrumenter.rb:58:in 'ActiveSupport::Notifications::Instrumenter#instrument'
activesupport (8.1.2) lib/active_support/notifications.rb:210:in 'ActiveSupport::Notifications.instrument'
actionpack (8.1.2) lib/action_controller/metal/instrumentation.rb:75:in 'ActionController::Instrumentation#process_action'
actionpack (8.1.2) lib/action_controller/metal/params_wrapper.rb:259:in 'ActionController::ParamsWrapper#process_action'
activerecord (8.1.2) lib/active_record/railties/controller_runtime.rb:39:in 'ActiveRecord::Railties::ControllerRuntime#process_action'
actionpack (8.1.2) lib/abstract_controller/base.rb:154:in 'AbstractController::Base#process'
actionview (8.1.2) lib/action_view/rendering.rb:40:in 'ActionView::Rendering#process'
actionpack (8.1.2) lib/action_controller/metal.rb:252:in 'ActionController::Metal#dispatch'
actionpack (8.1.2) lib/action_controller/metal.rb:335:in 'ActionController::Metal.dispatch'
actionpack (8.1.2) lib/action_dispatch/routing/route_set.rb:65:in 'ActionDispatch::Routing::RouteSet::Dispatcher#dispatch'
actionpack (8.1.2) lib/action_dispatch/routing/route_set.rb:50:in 'ActionDispatch::Routing::RouteSet::Dispatcher#serve'
actionpack (8.1.2) lib/action_dispatch/journey/router.rb:35:in 'block in ActionDispatch::Journey::Router#serve'
actionpack (8.1.2) lib/action_dispatch/journey/router.rb:86:in 'block in ActionDispatch::Journey::Router#recognize'
actionpack (8.1.2) lib/action_dispatch/journey/router.rb:66:in 'Array#each'
actionpack (8.1.2) lib/action_dispatch/journey/router.rb:66:in 'ActionDispatch::Journey::Router#recognize'
actionpack (8.1.2) lib/action_dispatch/journey/router.rb:31:in 'ActionDispatch::Journey::Router#serve'
actionpack (8.1.2) lib/action_dispatch/routing/route_set.rb:906:in 'ActionDispatch::Routing::RouteSet#call'
railties (8.1.2) lib/rails/engine/lazy_route_set.rb:60:in 'Rails::Engine::LazyRouteSet#call'
railties (8.1.2) lib/rails/engine.rb:534:in 'Rails::Engine#call'
railties (8.1.2) lib/rails/railtie.rb:225:in 'Kernel#public_send'
railties (8.1.2) lib/rails/railtie.rb:225:in 'Rails::Railtie.method_missing'
actionpack (8.1.2) lib/action_dispatch/routing/mapper.rb:33:in 'block in <class:Constraints>'
actionpack (8.1.2) lib/action_dispatch/routing/mapper.rb:62:in 'ActionDispatch::Routing::Mapper::Constraints#serve'
actionpack (8.1.2) lib/action_dispatch/journey/router.rb:35:in 'block in ActionDispatch::Journey::Router#serve'
actionpack (8.1.2) lib/action_dispatch/journey/router.rb:92:in 'block in ActionDispatch::Journey::Router#recognize'
actionpack (8.1.2) lib/action_dispatch/journey/router.rb:66:in 'Array#each'
actionpack (8.1.2) lib/action_dispatch/journey/router.rb:66:in 'ActionDispatch::Journey::Router#recognize'
actionpack (8.1.2) lib/action_dispatch/journey/router.rb:31:in 'ActionDispatch::Journey::Router#serve'
actionpack (8.1.2) lib/action_dispatch/routing/route_set.rb:906:in 'ActionDispatch::Routing::RouteSet#call'
railties (8.1.2) lib/rails/engine/lazy_route_set.rb:60:in 'Rails::Engine::LazyRouteSet#call'
rack (3.2.4) lib/rack/tempfile_reaper.rb:20:in 'Rack::TempfileReaper#call'
rack (3.2.4) lib/rack/etag.rb:29:in 'Rack::ETag#call'
rack (3.2.4) lib/rack/conditional_get.rb:44:in 'Rack::ConditionalGet#call'
rack (3.2.4) lib/rack/head.rb:15:in 'Rack::Head#call'
actionpack (8.1.2) lib/action_dispatch/http/content_security_policy.rb:38:in 'ActionDispatch::ContentSecurityPolicy::Middleware#call'
rack-session (2.1.1) lib/rack/session/abstract/id.rb:274:in 'Rack::Session::Abstract::Persisted#context'
rack-session (2.1.1) lib/rack/session/abstract/id.rb:268:in 'Rack::Session::Abstract::Persisted#call'
actionpack (8.1.2) lib/action_dispatch/middleware/cookies.rb:708:in 'ActionDispatch::Cookies#call'
actionpack (8.1.2) lib/action_dispatch/middleware/callbacks.rb:31:in 'block in ActionDispatch::Callbacks#call'
activesupport (8.1.2) lib/active_support/callbacks.rb:101:in 'ActiveSupport::Callbacks#run_callbacks'
actionpack (8.1.2) lib/action_dispatch/middleware/callbacks.rb:30:in 'ActionDispatch::Callbacks#call'
actionpack (8.1.2) lib/action_dispatch/middleware/actionable_exceptions.rb:18:in 'ActionDispatch::ActionableExceptions#call'
actionpack (8.1.2) lib/action_dispatch/middleware/debug_exceptions.rb:31:in 'ActionDispatch::DebugExceptions#call'
actionpack (8.1.2) lib/action_dispatch/middleware/show_exceptions.rb:32:in 'ActionDispatch::ShowExceptions#call'
railties (8.1.2) lib/rails/rack/logger.rb:41:in 'Rails::Rack::Logger#call_app'
railties (8.1.2) lib/rails/rack/logger.rb:29:in 'Rails::Rack::Logger#call'
actionpack (8.1.2) lib/action_dispatch/middleware/remote_ip.rb:98:in 'ActionDispatch::RemoteIp#call'
actionpack (8.1.2) lib/action_dispatch/middleware/request_id.rb:34:in 'ActionDispatch::RequestId#call'
rack (3.2.4) lib/rack/method_override.rb:28:in 'Rack::MethodOverride#call'
rack (3.2.4) lib/rack/runtime.rb:24:in 'Rack::Runtime#call'
actionpack (8.1.2) lib/action_dispatch/middleware/executor.rb:20:in 'ActionDispatch::Executor#call'
actionpack (8.1.2) lib/action_dispatch/middleware/static.rb:27:in 'ActionDispatch::Static#call'
rack (3.2.4) lib/rack/sendfile.rb:131:in 'Rack::Sendfile#call'
railties (8.1.2) lib/rails/engine.rb:534:in 'Rails::Engine#call'
rack-test (2.2.0) lib/rack/test.rb:360:in 'Rack::Test::Session#process_request'
rack-test (2.2.0) lib/rack/test.rb:153:in 'Rack::Test::Session#request'
actionpack (8.1.2) lib/action_dispatch/testing/integration.rb:297:in 'ActionDispatch::Integration::Session#process'
actionpack (8.1.2) lib/action_dispatch/testing/integration.rb:25:in 'ActionDispatch::Integration::RequestHelpers#post'
actionpack (8.1.2) lib/action_dispatch/testing/integration.rb:388:in 'ActionDispatch::Integration::Runner#post'
/Users/bryanbeshore/Desktop/query_lens/test/controllers/queries_controller_test.rb:57:in 'block in <class:QueriesControllerTest>'
minitest (6.0.1) lib/minitest/test.rb:91:in 'block (2 levels) in Minitest::Test#run'
minitest (6.0.1) lib/minitest/test.rb:187:in 'Minitest::Test#capture_exceptions'
minitest (6.0.1) lib/minitest/test.rb:86:in 'block in Minitest::Test#run'
minitest (6.0.1) lib/minitest.rb:396:in 'Minitest::Runnable#time_it'
minitest (6.0.1) lib/minitest/test.rb:85:in 'Minitest::Test#run'
activesupport (8.1.2) lib/active_support/executor/test_helper.rb:5:in 'block in ActiveSupport::Executor::TestHelper#run'
activesupport (8.1.2) lib/active_support/execution_wrapper.rb:104:in 'ActiveSupport::ExecutionWrapper.perform'
activesupport (8.1.2) lib/active_support/executor/test_helper.rb:5:in 'ActiveSupport::Executor::TestHelper#run'
minitest (6.0.1) lib/minitest.rb:485:in 'Minitest::Runnable.run'
minitest (6.0.1) lib/minitest.rb:472:in 'block (2 levels) in Minitest::Runnable.run_suite'
minitest (6.0.1) lib/minitest.rb:468:in 'Array#each'
minitest (6.0.1) lib/minitest.rb:468:in 'block in Minitest::Runnable.run_suite'
minitest (6.0.1) lib/minitest.rb:510:in 'Minitest::Runnable.on_signal'
minitest (6.0.1) lib/minitest.rb:497:in 'Minitest::Runnable.with_info_handler'
minitest (6.0.1) lib/minitest.rb:467:in 'Minitest::Runnable.run_suite'
minitest (6.0.1) lib/minitest.rb:360:in 'block in Minitest.run_all_suites'
minitest (6.0.1) lib/minitest.rb:360:in 'Array#map'
minitest (6.0.1) lib/minitest.rb:360:in 'Minitest.run_all_suites'
minitest (6.0.1) lib/minitest.rb:315:in 'Minitest.run'
minitest (6.0.1) lib/minitest.rb:84:in 'block in Minitest.autorun'
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[31mROLLBACK TRANSACTION[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[36mBEGIN deferred TRANSACTION[0m
---------------------------------------------------------------
QueryLens::QueriesControllerTest: test_show_renders_the_main_UI
---------------------------------------------------------------
  [1m[35m (0.1ms)[0m  [1m[35mDROP TABLE IF EXISTS "users"[0m
  [1m[35m (0.1ms)[0m  [1m[35mCREATE TABLE "users" ("id" integer PRIMARY KEY AUTOINCREMENT NOT NULL, "name" varchar, "email" varchar, "created_at" datetime(6) NOT NULL, "updated_at" datetime(6) NOT NULL)[0m
  [1m[35m (0.0ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" varchar NOT NULL PRIMARY KEY)[0m
  [1m[35m (0.0ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" varchar NOT NULL PRIMARY KEY, "value" varchar, "created_at" datetime(6) NOT NULL, "updated_at" datetime(6) NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.0ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::InternalMetadata Create (0.0ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES ('environment', 'test', '2026-02-07 18:17:04.799728', '2026-02-07 18:17:04.799729') RETURNING "key"[0m
  [1m[35m (0.0ms)[0m  [1m[32mINSERT INTO users (name, email, created_at, updated_at) VALUES ('Alice', 'alice@example.com', datetime('now'), datetime('now'))[0m
  [1m[35m (0.0ms)[0m  [1m[32mINSERT INTO users (name, email, created_at, updated_at) VALUES ('Bob', 'bob@example.com', datetime('now'), datetime('now'))[0m
Started GET "/query_lens/" for 127.0.0.1 at 2026-02-07 13:17:04 -0500
Processing by QueryLens::QueriesController#show as HTML
  Rendering /Users/bryanbeshore/Desktop/query_lens/app/views/query_lens/queries/show.html.erb
  Rendered /Users/bryanbeshore/Desktop/query_lens/app/views/query_lens/queries/show.html.erb (Duration: 0.5ms | GC: 0.1ms)
Completed 200 OK in 2ms (Views: 1.1ms | ActiveRecord: 0.0ms (0 queries, 0 cached) | GC: 0.1ms)
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[31mROLLBACK TRANSACTION[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[36mBEGIN deferred TRANSACTION[0m
------------------------------------------------------------------
QueryLens::AiControllerTest: test_generate_returns_SQL_from_Claude
------------------------------------------------------------------
  [1m[35m (0.1ms)[0m  [1m[35mDROP TABLE IF EXISTS "users"[0m
  [1m[35m (0.1ms)[0m  [1m[35mCREATE TABLE "users" ("id" integer PRIMARY KEY AUTOINCREMENT NOT NULL, "name" varchar, "email" varchar, "created_at" datetime(6) NOT NULL, "updated_at" datetime(6) NOT NULL)[0m
  [1m[35m (0.0ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" varchar NOT NULL PRIMARY KEY)[0m
  [1m[35m (0.0ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" varchar NOT NULL PRIMARY KEY, "value" varchar, "created_at" datetime(6) NOT NULL, "updated_at" datetime(6) NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.0ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::InternalMetadata Create (0.0ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES ('environment', 'test', '2026-02-07 18:17:04.803916', '2026-02-07 18:17:04.803917') RETURNING "key"[0m
Started POST "/query_lens/generate" for 127.0.0.1 at 2026-02-07 13:17:04 -0500
Processing by QueryLens::AiController#generate as JSON
  Parameters: {"messages" => [{"role" => "user", "content" => "How many users?"}], "ai" => {"messages" => [{"role" => "user", "content" => "How many users?"}]}}
Can't verify CSRF token authenticity.
Completed 422 Unprocessable Content in 0ms (ActiveRecord: 0.0ms (0 queries, 0 cached) | GC: 0.1ms)
  
ActionController::InvalidAuthenticityToken (Can't verify CSRF token authenticity.):
  
actionpack (8.1.2) lib/action_controller/metal/request_forgery_protection.rb:321:in 'ActionController::RequestForgeryProtection::ProtectionMethods::Exception#handle_unverified_request'
actionpack (8.1.2) lib/action_controller/metal/request_forgery_protection.rb:415:in 'ActionController::RequestForgeryProtection#handle_unverified_request'
actionpack (8.1.2) lib/action_controller/metal/request_forgery_protection.rb:404:in 'ActionController::RequestForgeryProtection#verify_authenticity_token'
activesupport (8.1.2) lib/active_support/callbacks.rb:362:in 'block in ActiveSupport::Callbacks::CallTemplate::MethodCall#make_lambda'
activesupport (8.1.2) lib/active_support/callbacks.rb:179:in 'block in ActiveSupport::Callbacks::Filters::Before#call'
actionpack (8.1.2) lib/abstract_controller/callbacks.rb:36:in 'block (2 levels) in <module:Callbacks>'
activesupport (8.1.2) lib/active_support/callbacks.rb:180:in 'ActiveSupport::Callbacks::Filters::Before#call'
activesupport (8.1.2) lib/active_support/callbacks.rb:560:in 'block in ActiveSupport::Callbacks::CallbackSequence#invoke_before'
activesupport (8.1.2) lib/active_support/callbacks.rb:560:in 'Array#each'
activesupport (8.1.2) lib/active_support/callbacks.rb:560:in 'ActiveSupport::Callbacks::CallbackSequence#invoke_before'
activesupport (8.1.2) lib/active_support/callbacks.rb:109:in 'ActiveSupport::Callbacks#run_callbacks'
actionpack (8.1.2) lib/abstract_controller/callbacks.rb:266:in 'AbstractController::Callbacks#process_action'
actionpack (8.1.2) lib/action_controller/metal/rescue.rb:36:in 'ActionController::Rescue#process_action'
actionpack (8.1.2) lib/action_controller/metal/instrumentation.rb:76:in 'block in ActionController::Instrumentation#process_action'
activesupport (8.1.2) lib/active_support/notifications.rb:210:in 'block in ActiveSupport::Notifications.instrument'
activesupport (8.1.2) lib/active_support/notifications/instrumenter.rb:58:in 'ActiveSupport::Notifications::Instrumenter#instrument'
activesupport (8.1.2) lib/active_support/notifications.rb:210:in 'ActiveSupport::Notifications.instrument'
actionpack (8.1.2) lib/action_controller/metal/instrumentation.rb:75:in 'ActionController::Instrumentation#process_action'
actionpack (8.1.2) lib/action_controller/metal/params_wrapper.rb:259:in 'ActionController::ParamsWrapper#process_action'
activerecord (8.1.2) lib/active_record/railties/controller_runtime.rb:39:in 'ActiveRecord::Railties::ControllerRuntime#process_action'
actionpack (8.1.2) lib/abstract_controller/base.rb:154:in 'AbstractController::Base#process'
actionview (8.1.2) lib/action_view/rendering.rb:40:in 'ActionView::Rendering#process'
actionpack (8.1.2) lib/action_controller/metal.rb:252:in 'ActionController::Metal#dispatch'
actionpack (8.1.2) lib/action_controller/metal.rb:335:in 'ActionController::Metal.dispatch'
actionpack (8.1.2) lib/action_dispatch/routing/route_set.rb:65:in 'ActionDispatch::Routing::RouteSet::Dispatcher#dispatch'
actionpack (8.1.2) lib/action_dispatch/routing/route_set.rb:50:in 'ActionDispatch::Routing::RouteSet::Dispatcher#serve'
actionpack (8.1.2) lib/action_dispatch/journey/router.rb:35:in 'block in ActionDispatch::Journey::Router#serve'
actionpack (8.1.2) lib/action_dispatch/journey/router.rb:86:in 'block in ActionDispatch::Journey::Router#recognize'
actionpack (8.1.2) lib/action_dispatch/journey/router.rb:66:in 'Array#each'
actionpack (8.1.2) lib/action_dispatch/journey/router.rb:66:in 'ActionDispatch::Journey::Router#recognize'
actionpack (8.1.2) lib/action_dispatch/journey/router.rb:31:in 'ActionDispatch::Journey::Router#serve'
actionpack (8.1.2) lib/action_dispatch/routing/route_set.rb:906:in 'ActionDispatch::Routing::RouteSet#call'
railties (8.1.2) lib/rails/engine/lazy_route_set.rb:60:in 'Rails::Engine::LazyRouteSet#call'
railties (8.1.2) lib/rails/engine.rb:534:in 'Rails::Engine#call'
railties (8.1.2) lib/rails/railtie.rb:225:in 'Kernel#public_send'
railties (8.1.2) lib/rails/railtie.rb:225:in 'Rails::Railtie.method_missing'
actionpack (8.1.2) lib/action_dispatch/routing/mapper.rb:33:in 'block in <class:Constraints>'
actionpack (8.1.2) lib/action_dispatch/routing/mapper.rb:62:in 'ActionDispatch::Routing::Mapper::Constraints#serve'
actionpack (8.1.2) lib/action_dispatch/journey/router.rb:35:in 'block in ActionDispatch::Journey::Router#serve'
actionpack (8.1.2) lib/action_dispatch/journey/router.rb:92:in 'block in ActionDispatch::Journey::Router#recognize'
actionpack (8.1.2) lib/action_dispatch/journey/router.rb:66:in 'Array#each'
actionpack (8.1.2) lib/action_dispatch/journey/router.rb:66:in 'ActionDispatch::Journey::Router#recognize'
actionpack (8.1.2) lib/action_dispatch/journey/router.rb:31:in 'ActionDispatch::Journey::Router#serve'
actionpack (8.1.2) lib/action_dispatch/routing/route_set.rb:906:in 'ActionDispatch::Routing::RouteSet#call'
railties (8.1.2) lib/rails/engine/lazy_route_set.rb:60:in 'Rails::Engine::LazyRouteSet#call'
rack (3.2.4) lib/rack/tempfile_reaper.rb:20:in 'Rack::TempfileReaper#call'
rack (3.2.4) lib/rack/etag.rb:29:in 'Rack::ETag#call'
rack (3.2.4) lib/rack/conditional_get.rb:44:in 'Rack::ConditionalGet#call'
rack (3.2.4) lib/rack/head.rb:15:in 'Rack::Head#call'
actionpack (8.1.2) lib/action_dispatch/http/content_security_policy.rb:38:in 'ActionDispatch::ContentSecurityPolicy::Middleware#call'
rack-session (2.1.1) lib/rack/session/abstract/id.rb:274:in 'Rack::Session::Abstract::Persisted#context'
rack-session (2.1.1) lib/rack/session/abstract/id.rb:268:in 'Rack::Session::Abstract::Persisted#call'
actionpack (8.1.2) lib/action_dispatch/middleware/cookies.rb:708:in 'ActionDispatch::Cookies#call'
actionpack (8.1.2) lib/action_dispatch/middleware/callbacks.rb:31:in 'block in ActionDispatch::Callbacks#call'
activesupport (8.1.2) lib/active_support/callbacks.rb:101:in 'ActiveSupport::Callbacks#run_callbacks'
actionpack (8.1.2) lib/action_dispatch/middleware/callbacks.rb:30:in 'ActionDispatch::Callbacks#call'
actionpack (8.1.2) lib/action_dispatch/middleware/actionable_exceptions.rb:18:in 'ActionDispatch::ActionableExceptions#call'
actionpack (8.1.2) lib/action_dispatch/middleware/debug_exceptions.rb:31:in 'ActionDispatch::DebugExceptions#call'
actionpack (8.1.2) lib/action_dispatch/middleware/show_exceptions.rb:32:in 'ActionDispatch::ShowExceptions#call'
railties (8.1.2) lib/rails/rack/logger.rb:41:in 'Rails::Rack::Logger#call_app'
railties (8.1.2) lib/rails/rack/logger.rb:29:in 'Rails::Rack::Logger#call'
actionpack (8.1.2) lib/action_dispatch/middleware/remote_ip.rb:98:in 'ActionDispatch::RemoteIp#call'
actionpack (8.1.2) lib/action_dispatch/middleware/request_id.rb:34:in 'ActionDispatch::RequestId#call'
rack (3.2.4) lib/rack/method_override.rb:28:in 'Rack::MethodOverride#call'
rack (3.2.4) lib/rack/runtime.rb:24:in 'Rack::Runtime#call'
actionpack (8.1.2) lib/action_dispatch/middleware/executor.rb:20:in 'ActionDispatch::Executor#call'
actionpack (8.1.2) lib/action_dispatch/middleware/static.rb:27:in 'ActionDispatch::Static#call'
rack (3.2.4) lib/rack/sendfile.rb:131:in 'Rack::Sendfile#call'
railties (8.1.2) lib/rails/engine.rb:534:in 'Rails::Engine#call'
rack-test (2.2.0) lib/rack/test.rb:360:in 'Rack::Test::Session#process_request'
rack-test (2.2.0) lib/rack/test.rb:153:in 'Rack::Test::Session#request'
actionpack (8.1.2) lib/action_dispatch/testing/integration.rb:297:in 'ActionDispatch::Integration::Session#process'
actionpack (8.1.2) lib/action_dispatch/testing/integration.rb:25:in 'ActionDispatch::Integration::RequestHelpers#post'
actionpack (8.1.2) lib/action_dispatch/testing/integration.rb:388:in 'ActionDispatch::Integration::Runner#post'
/Users/bryanbeshore/Desktop/query_lens/test/controllers/ai_controller_test.rb:29:in 'block in <class:AiControllerTest>'
minitest (6.0.1) lib/minitest/test.rb:91:in 'block (2 levels) in Minitest::Test#run'
minitest (6.0.1) lib/minitest/test.rb:187:in 'Minitest::Test#capture_exceptions'
minitest (6.0.1) lib/minitest/test.rb:86:in 'block in Minitest::Test#run'
minitest (6.0.1) lib/minitest.rb:396:in 'Minitest::Runnable#time_it'
minitest (6.0.1) lib/minitest/test.rb:85:in 'Minitest::Test#run'
activesupport (8.1.2) lib/active_support/executor/test_helper.rb:5:in 'block in ActiveSupport::Executor::TestHelper#run'
activesupport (8.1.2) lib/active_support/execution_wrapper.rb:104:in 'ActiveSupport::ExecutionWrapper.perform'
activesupport (8.1.2) lib/active_support/executor/test_helper.rb:5:in 'ActiveSupport::Executor::TestHelper#run'
minitest (6.0.1) lib/minitest.rb:485:in 'Minitest::Runnable.run'
minitest (6.0.1) lib/minitest.rb:472:in 'block (2 levels) in Minitest::Runnable.run_suite'
minitest (6.0.1) lib/minitest.rb:468:in 'Array#each'
minitest (6.0.1) lib/minitest.rb:468:in 'block in Minitest::Runnable.run_suite'
minitest (6.0.1) lib/minitest.rb:510:in 'Minitest::Runnable.on_signal'
minitest (6.0.1) lib/minitest.rb:497:in 'Minitest::Runnable.with_info_handler'
minitest (6.0.1) lib/minitest.rb:467:in 'Minitest::Runnable.run_suite'
minitest (6.0.1) lib/minitest.rb:360:in 'block in Minitest.run_all_suites'
minitest (6.0.1) lib/minitest.rb:360:in 'Array#map'
minitest (6.0.1) lib/minitest.rb:360:in 'Minitest.run_all_suites'
minitest (6.0.1) lib/minitest.rb:315:in 'Minitest.run'
minitest (6.0.1) lib/minitest.rb:84:in 'block in Minitest.autorun'
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK TRANSACTION[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[36mBEGIN deferred TRANSACTION[0m
-----------------------------------------------------------------------
QueryLens::AiControllerTest: test_generate_returns_error_when_API_fails
-----------------------------------------------------------------------
  [1m[35m (0.1ms)[0m  [1m[35mDROP TABLE IF EXISTS "users"[0m
  [1m[35m (0.1ms)[0m  [1m[35mCREATE TABLE "users" ("id" integer PRIMARY KEY AUTOINCREMENT NOT NULL, "name" varchar, "email" varchar, "created_at" datetime(6) NOT NULL, "updated_at" datetime(6) NOT NULL)[0m
  [1m[35m (0.0ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" varchar NOT NULL PRIMARY KEY)[0m
  [1m[35m (0.0ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" varchar NOT NULL PRIMARY KEY, "value" varchar, "created_at" datetime(6) NOT NULL, "updated_at" datetime(6) NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.0ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::InternalMetadata Create (0.0ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES ('environment', 'test', '2026-02-07 18:17:04.904476', '2026-02-07 18:17:04.904478') RETURNING "key"[0m
Started POST "/query_lens/generate" for 127.0.0.1 at 2026-02-07 13:17:04 -0500
Processing by QueryLens::AiController#generate as JSON
  Parameters: {"messages" => [{"role" => "user", "content" => "test"}], "ai" => {"messages" => [{"role" => "user", "content" => "test"}]}}
Can't verify CSRF token authenticity.
Completed 422 Unprocessable Content in 0ms (ActiveRecord: 0.0ms (0 queries, 0 cached) | GC: 0.0ms)
  
ActionController::InvalidAuthenticityToken (Can't verify CSRF token authenticity.):
  
actionpack (8.1.2) lib/action_controller/metal/request_forgery_protection.rb:321:in 'ActionController::RequestForgeryProtection::ProtectionMethods::Exception#handle_unverified_request'
actionpack (8.1.2) lib/action_controller/metal/request_forgery_protection.rb:415:in 'ActionController::RequestForgeryProtection#handle_unverified_request'
actionpack (8.1.2) lib/action_controller/metal/request_forgery_protection.rb:404:in 'ActionController::RequestForgeryProtection#verify_authenticity_token'
activesupport (8.1.2) lib/active_support/callbacks.rb:362:in 'block in ActiveSupport::Callbacks::CallTemplate::MethodCall#make_lambda'
activesupport (8.1.2) lib/active_support/callbacks.rb:179:in 'block in ActiveSupport::Callbacks::Filters::Before#call'
actionpack (8.1.2) lib/abstract_controller/callbacks.rb:36:in 'block (2 levels) in <module:Callbacks>'
activesupport (8.1.2) lib/active_support/callbacks.rb:180:in 'ActiveSupport::Callbacks::Filters::Before#call'
activesupport (8.1.2) lib/active_support/callbacks.rb:560:in 'block in ActiveSupport::Callbacks::CallbackSequence#invoke_before'
activesupport (8.1.2) lib/active_support/callbacks.rb:560:in 'Array#each'
activesupport (8.1.2) lib/active_support/callbacks.rb:560:in 'ActiveSupport::Callbacks::CallbackSequence#invoke_before'
activesupport (8.1.2) lib/active_support/callbacks.rb:109:in 'ActiveSupport::Callbacks#run_callbacks'
actionpack (8.1.2) lib/abstract_controller/callbacks.rb:266:in 'AbstractController::Callbacks#process_action'
actionpack (8.1.2) lib/action_controller/metal/rescue.rb:36:in 'ActionController::Rescue#process_action'
actionpack (8.1.2) lib/action_controller/metal/instrumentation.rb:76:in 'block in ActionController::Instrumentation#process_action'
activesupport (8.1.2) lib/active_support/notifications.rb:210:in 'block in ActiveSupport::Notifications.instrument'
activesupport (8.1.2) lib/active_support/notifications/instrumenter.rb:58:in 'ActiveSupport::Notifications::Instrumenter#instrument'
activesupport (8.1.2) lib/active_support/notifications.rb:210:in 'ActiveSupport::Notifications.instrument'
actionpack (8.1.2) lib/action_controller/metal/instrumentation.rb:75:in 'ActionController::Instrumentation#process_action'
actionpack (8.1.2) lib/action_controller/metal/params_wrapper.rb:259:in 'ActionController::ParamsWrapper#process_action'
activerecord (8.1.2) lib/active_record/railties/controller_runtime.rb:39:in 'ActiveRecord::Railties::ControllerRuntime#process_action'
actionpack (8.1.2) lib/abstract_controller/base.rb:154:in 'AbstractController::Base#process'
actionview (8.1.2) lib/action_view/rendering.rb:40:in 'ActionView::Rendering#process'
actionpack (8.1.2) lib/action_controller/metal.rb:252:in 'ActionController::Metal#dispatch'
actionpack (8.1.2) lib/action_controller/metal.rb:335:in 'ActionController::Metal.dispatch'
actionpack (8.1.2) lib/action_dispatch/routing/route_set.rb:65:in 'ActionDispatch::Routing::RouteSet::Dispatcher#dispatch'
actionpack (8.1.2) lib/action_dispatch/routing/route_set.rb:50:in 'ActionDispatch::Routing::RouteSet::Dispatcher#serve'
actionpack (8.1.2) lib/action_dispatch/journey/router.rb:35:in 'block in ActionDispatch::Journey::Router#serve'
actionpack (8.1.2) lib/action_dispatch/journey/router.rb:86:in 'block in ActionDispatch::Journey::Router#recognize'
actionpack (8.1.2) lib/action_dispatch/journey/router.rb:66:in 'Array#each'
actionpack (8.1.2) lib/action_dispatch/journey/router.rb:66:in 'ActionDispatch::Journey::Router#recognize'
actionpack (8.1.2) lib/action_dispatch/journey/router.rb:31:in 'ActionDispatch::Journey::Router#serve'
actionpack (8.1.2) lib/action_dispatch/routing/route_set.rb:906:in 'ActionDispatch::Routing::RouteSet#call'
railties (8.1.2) lib/rails/engine/lazy_route_set.rb:60:in 'Rails::Engine::LazyRouteSet#call'
railties (8.1.2) lib/rails/engine.rb:534:in 'Rails::Engine#call'
railties (8.1.2) lib/rails/railtie.rb:225:in 'Kernel#public_send'
railties (8.1.2) lib/rails/railtie.rb:225:in 'Rails::Railtie.method_missing'
actionpack (8.1.2) lib/action_dispatch/routing/mapper.rb:33:in 'block in <class:Constraints>'
actionpack (8.1.2) lib/action_dispatch/routing/mapper.rb:62:in 'ActionDispatch::Routing::Mapper::Constraints#serve'
actionpack (8.1.2) lib/action_dispatch/journey/router.rb:35:in 'block in ActionDispatch::Journey::Router#serve'
actionpack (8.1.2) lib/action_dispatch/journey/router.rb:92:in 'block in ActionDispatch::Journey::Router#recognize'
actionpack (8.1.2) lib/action_dispatch/journey/router.rb:66:in 'Array#each'
actionpack (8.1.2) lib/action_dispatch/journey/router.rb:66:in 'ActionDispatch::Journey::Router#recognize'
actionpack (8.1.2) lib/action_dispatch/journey/router.rb:31:in 'ActionDispatch::Journey::Router#serve'
actionpack (8.1.2) lib/action_dispatch/routing/route_set.rb:906:in 'ActionDispatch::Routing::RouteSet#call'
railties (8.1.2) lib/rails/engine/lazy_route_set.rb:60:in 'Rails::Engine::LazyRouteSet#call'
rack (3.2.4) lib/rack/tempfile_reaper.rb:20:in 'Rack::TempfileReaper#call'
rack (3.2.4) lib/rack/etag.rb:29:in 'Rack::ETag#call'
rack (3.2.4) lib/rack/conditional_get.rb:44:in 'Rack::ConditionalGet#call'
rack (3.2.4) lib/rack/head.rb:15:in 'Rack::Head#call'
actionpack (8.1.2) lib/action_dispatch/http/content_security_policy.rb:38:in 'ActionDispatch::ContentSecurityPolicy::Middleware#call'
rack-session (2.1.1) lib/rack/session/abstract/id.rb:274:in 'Rack::Session::Abstract::Persisted#context'
rack-session (2.1.1) lib/rack/session/abstract/id.rb:268:in 'Rack::Session::Abstract::Persisted#call'
actionpack (8.1.2) lib/action_dispatch/middleware/cookies.rb:708:in 'ActionDispatch::Cookies#call'
actionpack (8.1.2) lib/action_dispatch/middleware/callbacks.rb:31:in 'block in ActionDispatch::Callbacks#call'
activesupport (8.1.2) lib/active_support/callbacks.rb:101:in 'ActiveSupport::Callbacks#run_callbacks'
actionpack (8.1.2) lib/action_dispatch/middleware/callbacks.rb:30:in 'ActionDispatch::Callbacks#call'
actionpack (8.1.2) lib/action_dispatch/middleware/actionable_exceptions.rb:18:in 'ActionDispatch::ActionableExceptions#call'
actionpack (8.1.2) lib/action_dispatch/middleware/debug_exceptions.rb:31:in 'ActionDispatch::DebugExceptions#call'
actionpack (8.1.2) lib/action_dispatch/middleware/show_exceptions.rb:32:in 'ActionDispatch::ShowExceptions#call'
railties (8.1.2) lib/rails/rack/logger.rb:41:in 'Rails::Rack::Logger#call_app'
railties (8.1.2) lib/rails/rack/logger.rb:29:in 'Rails::Rack::Logger#call'
actionpack (8.1.2) lib/action_dispatch/middleware/remote_ip.rb:98:in 'ActionDispatch::RemoteIp#call'
actionpack (8.1.2) lib/action_dispatch/middleware/request_id.rb:34:in 'ActionDispatch::RequestId#call'
rack (3.2.4) lib/rack/method_override.rb:28:in 'Rack::MethodOverride#call'
rack (3.2.4) lib/rack/runtime.rb:24:in 'Rack::Runtime#call'
actionpack (8.1.2) lib/action_dispatch/middleware/executor.rb:20:in 'ActionDispatch::Executor#call'
actionpack (8.1.2) lib/action_dispatch/middleware/static.rb:27:in 'ActionDispatch::Static#call'
rack (3.2.4) lib/rack/sendfile.rb:131:in 'Rack::Sendfile#call'
railties (8.1.2) lib/rails/engine.rb:534:in 'Rails::Engine#call'
rack-test (2.2.0) lib/rack/test.rb:360:in 'Rack::Test::Session#process_request'
rack-test (2.2.0) lib/rack/test.rb:153:in 'Rack::Test::Session#request'
actionpack (8.1.2) lib/action_dispatch/testing/integration.rb:297:in 'ActionDispatch::Integration::Session#process'
actionpack (8.1.2) lib/action_dispatch/testing/integration.rb:25:in 'ActionDispatch::Integration::RequestHelpers#post'
actionpack (8.1.2) lib/action_dispatch/testing/integration.rb:388:in 'ActionDispatch::Integration::Runner#post'
/Users/bryanbeshore/Desktop/query_lens/test/controllers/ai_controller_test.rb:43:in 'block in <class:AiControllerTest>'
minitest (6.0.1) lib/minitest/test.rb:91:in 'block (2 levels) in Minitest::Test#run'
minitest (6.0.1) lib/minitest/test.rb:187:in 'Minitest::Test#capture_exceptions'
minitest (6.0.1) lib/minitest/test.rb:86:in 'block in Minitest::Test#run'
minitest (6.0.1) lib/minitest.rb:396:in 'Minitest::Runnable#time_it'
minitest (6.0.1) lib/minitest/test.rb:85:in 'Minitest::Test#run'
activesupport (8.1.2) lib/active_support/executor/test_helper.rb:5:in 'block in ActiveSupport::Executor::TestHelper#run'
activesupport (8.1.2) lib/active_support/execution_wrapper.rb:104:in 'ActiveSupport::ExecutionWrapper.perform'
activesupport (8.1.2) lib/active_support/executor/test_helper.rb:5:in 'ActiveSupport::Executor::TestHelper#run'
minitest (6.0.1) lib/minitest.rb:485:in 'Minitest::Runnable.run'
minitest (6.0.1) lib/minitest.rb:472:in 'block (2 levels) in Minitest::Runnable.run_suite'
minitest (6.0.1) lib/minitest.rb:468:in 'Array#each'
minitest (6.0.1) lib/minitest.rb:468:in 'block in Minitest::Runnable.run_suite'
minitest (6.0.1) lib/minitest.rb:510:in 'Minitest::Runnable.on_signal'
minitest (6.0.1) lib/minitest.rb:497:in 'Minitest::Runnable.with_info_handler'
minitest (6.0.1) lib/minitest.rb:467:in 'Minitest::Runnable.run_suite'
minitest (6.0.1) lib/minitest.rb:360:in 'block in Minitest.run_all_suites'
minitest (6.0.1) lib/minitest.rb:360:in 'Array#map'
minitest (6.0.1) lib/minitest.rb:360:in 'Minitest.run_all_suites'
minitest (6.0.1) lib/minitest.rb:315:in 'Minitest.run'
minitest (6.0.1) lib/minitest.rb:84:in 'block in Minitest.autorun'
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK TRANSACTION[0m
  [1m[35m (0.1ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" varchar NOT NULL PRIMARY KEY)[0m
  [1m[35m (0.1ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" varchar NOT NULL PRIMARY KEY, "value" varchar, "created_at" datetime(6) NOT NULL, "updated_at" datetime(6) NOT NULL)[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.4ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[36mBEGIN deferred TRANSACTION[0m
-------------------------------------------------------------------------
QueryLens::QueriesControllerTest: test_execute_rejects_non-SELECT_queries
-------------------------------------------------------------------------
  [1m[35m (0.0ms)[0m  [1m[35mDROP TABLE IF EXISTS "users"[0m
  [1m[35m (0.1ms)[0m  [1m[35mCREATE TABLE "users" ("id" integer PRIMARY KEY AUTOINCREMENT NOT NULL, "name" varchar, "email" varchar, "created_at" datetime(6) NOT NULL, "updated_at" datetime(6) NOT NULL)[0m
  [1m[35m (0.0ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" varchar NOT NULL PRIMARY KEY)[0m
  [1m[35m (0.0ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" varchar NOT NULL PRIMARY KEY, "value" varchar, "created_at" datetime(6) NOT NULL, "updated_at" datetime(6) NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::InternalMetadata Create (0.1ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES ('environment', 'test', '2026-02-07 18:18:38.034578', '2026-02-07 18:18:38.034584') RETURNING "key"[0m
  [1m[35m (0.0ms)[0m  [1m[32mINSERT INTO users (name, email, created_at, updated_at) VALUES ('Alice', 'alice@example.com', datetime('now'), datetime('now'))[0m
  [1m[35m (0.0ms)[0m  [1m[32mINSERT INTO users (name, email, created_at, updated_at) VALUES ('Bob', 'bob@example.com', datetime('now'), datetime('now'))[0m
Started POST "/query_lens/execute" for 127.0.0.1 at 2026-02-07 13:18:38 -0500
Processing by QueryLens::QueriesController#execute as JSON
  Parameters: {"sql" => "DELETE FROM users", "query" => {"sql" => "DELETE FROM users"}}
Can't verify CSRF token authenticity.
Completed 422 Unprocessable Content in 0ms (Views: 0.1ms | ActiveRecord: 0.0ms (0 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[31mROLLBACK TRANSACTION[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[36mBEGIN deferred TRANSACTION[0m
------------------------------------------------------------------
QueryLens::QueriesControllerTest: test_execute_runs_SELECT_queries
------------------------------------------------------------------
  [1m[35m (0.1ms)[0m  [1m[35mDROP TABLE IF EXISTS "users"[0m
  [1m[35m (0.1ms)[0m  [1m[35mCREATE TABLE "users" ("id" integer PRIMARY KEY AUTOINCREMENT NOT NULL, "name" varchar, "email" varchar, "created_at" datetime(6) NOT NULL, "updated_at" datetime(6) NOT NULL)[0m
  [1m[35m (0.0ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" varchar NOT NULL PRIMARY KEY)[0m
  [1m[35m (0.0ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" varchar NOT NULL PRIMARY KEY, "value" varchar, "created_at" datetime(6) NOT NULL, "updated_at" datetime(6) NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.0ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::InternalMetadata Create (0.0ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES ('environment', 'test', '2026-02-07 18:18:38.080247', '2026-02-07 18:18:38.080251') RETURNING "key"[0m
  [1m[35m (0.0ms)[0m  [1m[32mINSERT INTO users (name, email, created_at, updated_at) VALUES ('Alice', 'alice@example.com', datetime('now'), datetime('now'))[0m
  [1m[35m (0.0ms)[0m  [1m[32mINSERT INTO users (name, email, created_at, updated_at) VALUES ('Bob', 'bob@example.com', datetime('now'), datetime('now'))[0m
Started POST "/query_lens/execute" for 127.0.0.1 at 2026-02-07 13:18:38 -0500
Processing by QueryLens::QueriesController#execute as JSON
  Parameters: {"sql" => "SELECT name, email FROM users ORDER BY name", "query" => {"sql" => "SELECT name, email FROM users ORDER BY name"}}
Can't verify CSRF token authenticity.
  [1m[35mSQL (0.0ms)[0m  [1m[34mSELECT name, email FROM users ORDER BY name[0m
Completed 200 OK in 0ms (Views: 0.0ms | ActiveRecord: 0.0ms (1 query, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[31mROLLBACK TRANSACTION[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[36mBEGIN deferred TRANSACTION[0m
------------------------------------------------------------------------
QueryLens::QueriesControllerTest: test_execute_rejects_UPDATE_statements
------------------------------------------------------------------------
  [1m[35m (0.0ms)[0m  [1m[35mDROP TABLE IF EXISTS "users"[0m
  [1m[35m (0.0ms)[0m  [1m[35mCREATE TABLE "users" ("id" integer PRIMARY KEY AUTOINCREMENT NOT NULL, "name" varchar, "email" varchar, "created_at" datetime(6) NOT NULL, "updated_at" datetime(6) NOT NULL)[0m
  [1m[35m (0.0ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" varchar NOT NULL PRIMARY KEY)[0m
  [1m[35m (0.0ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" varchar NOT NULL PRIMARY KEY, "value" varchar, "created_at" datetime(6) NOT NULL, "updated_at" datetime(6) NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.0ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::InternalMetadata Create (0.0ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES ('environment', 'test', '2026-02-07 18:18:38.082274', '2026-02-07 18:18:38.082275') RETURNING "key"[0m
  [1m[35m (0.0ms)[0m  [1m[32mINSERT INTO users (name, email, created_at, updated_at) VALUES ('Alice', 'alice@example.com', datetime('now'), datetime('now'))[0m
  [1m[35m (0.0ms)[0m  [1m[32mINSERT INTO users (name, email, created_at, updated_at) VALUES ('Bob', 'bob@example.com', datetime('now'), datetime('now'))[0m
Started POST "/query_lens/execute" for 127.0.0.1 at 2026-02-07 13:18:38 -0500
Processing by QueryLens::QueriesController#execute as JSON
  Parameters: {"sql" => "UPDATE users SET name = 'hacked'", "query" => {"sql" => "UPDATE users SET name = 'hacked'"}}
Can't verify CSRF token authenticity.
Completed 422 Unprocessable Content in 0ms (Views: 0.0ms | ActiveRecord: 0.0ms (0 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[31mROLLBACK TRANSACTION[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[36mBEGIN deferred TRANSACTION[0m
----------------------------------------------------------------------------
QueryLens::QueriesControllerTest: test_execute_handles_SQL_errors_gracefully
----------------------------------------------------------------------------
  [1m[35m (0.0ms)[0m  [1m[35mDROP TABLE IF EXISTS "users"[0m
  [1m[35m (0.0ms)[0m  [1m[35mCREATE TABLE "users" ("id" integer PRIMARY KEY AUTOINCREMENT NOT NULL, "name" varchar, "email" varchar, "created_at" datetime(6) NOT NULL, "updated_at" datetime(6) NOT NULL)[0m
  [1m[35m (0.0ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" varchar NOT NULL PRIMARY KEY)[0m
  [1m[35m (0.0ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" varchar NOT NULL PRIMARY KEY, "value" varchar, "created_at" datetime(6) NOT NULL, "updated_at" datetime(6) NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.0ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::InternalMetadata Create (0.0ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES ('environment', 'test', '2026-02-07 18:18:38.083783', '2026-02-07 18:18:38.083783') RETURNING "key"[0m
  [1m[35m (0.0ms)[0m  [1m[32mINSERT INTO users (name, email, created_at, updated_at) VALUES ('Alice', 'alice@example.com', datetime('now'), datetime('now'))[0m
  [1m[35m (0.0ms)[0m  [1m[32mINSERT INTO users (name, email, created_at, updated_at) VALUES ('Bob', 'bob@example.com', datetime('now'), datetime('now'))[0m
Started POST "/query_lens/execute" for 127.0.0.1 at 2026-02-07 13:18:38 -0500
Processing by QueryLens::QueriesController#execute as JSON
  Parameters: {"sql" => "SELECT * FROM nonexistent_table", "query" => {"sql" => "SELECT * FROM nonexistent_table"}}
Can't verify CSRF token authenticity.
  [1m[35mSQL (0.2ms)[0m  [1m[34mSELECT * FROM nonexistent_table[0m
Completed 422 Unprocessable Content in 0ms (Views: 0.0ms | ActiveRecord: 0.2ms (1 query, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[31mROLLBACK TRANSACTION[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[36mBEGIN deferred TRANSACTION[0m
----------------------------------------------------------------------
QueryLens::QueriesControllerTest: test_execute_rejects_DROP_statements
----------------------------------------------------------------------
  [1m[35m (0.0ms)[0m  [1m[35mDROP TABLE IF EXISTS "users"[0m
  [1m[35m (0.0ms)[0m  [1m[35mCREATE TABLE "users" ("id" integer PRIMARY KEY AUTOINCREMENT NOT NULL, "name" varchar, "email" varchar, "created_at" datetime(6) NOT NULL, "updated_at" datetime(6) NOT NULL)[0m
  [1m[35m (0.0ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" varchar NOT NULL PRIMARY KEY)[0m
  [1m[35m (0.0ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" varchar NOT NULL PRIMARY KEY, "value" varchar, "created_at" datetime(6) NOT NULL, "updated_at" datetime(6) NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.0ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::InternalMetadata Create (0.0ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES ('environment', 'test', '2026-02-07 18:18:38.085494', '2026-02-07 18:18:38.085495') RETURNING "key"[0m
  [1m[35m (0.0ms)[0m  [1m[32mINSERT INTO users (name, email, created_at, updated_at) VALUES ('Alice', 'alice@example.com', datetime('now'), datetime('now'))[0m
  [1m[35m (0.0ms)[0m  [1m[32mINSERT INTO users (name, email, created_at, updated_at) VALUES ('Bob', 'bob@example.com', datetime('now'), datetime('now'))[0m
Started POST "/query_lens/execute" for 127.0.0.1 at 2026-02-07 13:18:38 -0500
Processing by QueryLens::QueriesController#execute as JSON
  Parameters: {"sql" => "DROP TABLE users", "query" => {"sql" => "DROP TABLE users"}}
Can't verify CSRF token authenticity.
Completed 422 Unprocessable Content in 0ms (Views: 0.0ms | ActiveRecord: 0.0ms (0 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[31mROLLBACK TRANSACTION[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[36mBEGIN deferred TRANSACTION[0m
---------------------------------------------------------------
QueryLens::QueriesControllerTest: test_show_renders_the_main_UI
---------------------------------------------------------------
  [1m[35m (0.1ms)[0m  [1m[35mDROP TABLE IF EXISTS "users"[0m
  [1m[35m (0.0ms)[0m  [1m[35mCREATE TABLE "users" ("id" integer PRIMARY KEY AUTOINCREMENT NOT NULL, "name" varchar, "email" varchar, "created_at" datetime(6) NOT NULL, "updated_at" datetime(6) NOT NULL)[0m
  [1m[35m (0.0ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" varchar NOT NULL PRIMARY KEY)[0m
  [1m[35m (0.0ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" varchar NOT NULL PRIMARY KEY, "value" varchar, "created_at" datetime(6) NOT NULL, "updated_at" datetime(6) NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.0ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::InternalMetadata Create (0.0ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES ('environment', 'test', '2026-02-07 18:18:38.086978', '2026-02-07 18:18:38.086979') RETURNING "key"[0m
  [1m[35m (0.0ms)[0m  [1m[32mINSERT INTO users (name, email, created_at, updated_at) VALUES ('Alice', 'alice@example.com', datetime('now'), datetime('now'))[0m
  [1m[35m (0.0ms)[0m  [1m[32mINSERT INTO users (name, email, created_at, updated_at) VALUES ('Bob', 'bob@example.com', datetime('now'), datetime('now'))[0m
Started GET "/query_lens/" for 127.0.0.1 at 2026-02-07 13:18:38 -0500
Processing by QueryLens::QueriesController#show as HTML
  Rendering /Users/bryanbeshore/Desktop/query_lens/app/views/query_lens/queries/show.html.erb
  Rendered /Users/bryanbeshore/Desktop/query_lens/app/views/query_lens/queries/show.html.erb (Duration: 0.4ms | GC: 0.0ms)
Completed 200 OK in 5ms (Views: 2.0ms | ActiveRecord: 0.0ms (0 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[31mROLLBACK TRANSACTION[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[36mBEGIN deferred TRANSACTION[0m
------------------------------------------------------------------------------
QueryLens::QueriesControllerTest: test_execute_respects_max_rows_configuration
------------------------------------------------------------------------------
  [1m[35m (0.0ms)[0m  [1m[35mDROP TABLE IF EXISTS "users"[0m
  [1m[35m (0.1ms)[0m  [1m[35mCREATE TABLE "users" ("id" integer PRIMARY KEY AUTOINCREMENT NOT NULL, "name" varchar, "email" varchar, "created_at" datetime(6) NOT NULL, "updated_at" datetime(6) NOT NULL)[0m
  [1m[35m (0.0ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" varchar NOT NULL PRIMARY KEY)[0m
  [1m[35m (0.0ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" varchar NOT NULL PRIMARY KEY, "value" varchar, "created_at" datetime(6) NOT NULL, "updated_at" datetime(6) NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.0ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::InternalMetadata Create (0.0ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES ('environment', 'test', '2026-02-07 18:18:38.093269', '2026-02-07 18:18:38.093270') RETURNING "key"[0m
  [1m[35m (0.0ms)[0m  [1m[32mINSERT INTO users (name, email, created_at, updated_at) VALUES ('Alice', 'alice@example.com', datetime('now'), datetime('now'))[0m
  [1m[35m (0.0ms)[0m  [1m[32mINSERT INTO users (name, email, created_at, updated_at) VALUES ('Bob', 'bob@example.com', datetime('now'), datetime('now'))[0m
Started POST "/query_lens/execute" for 127.0.0.1 at 2026-02-07 13:18:38 -0500
Processing by QueryLens::QueriesController#execute as JSON
  Parameters: {"sql" => "SELECT * FROM users", "query" => {"sql" => "SELECT * FROM users"}}
Can't verify CSRF token authenticity.
  [1m[35mSQL (0.1ms)[0m  [1m[34mSELECT * FROM users[0m
Completed 200 OK in 0ms (Views: 0.0ms | ActiveRecord: 0.1ms (1 query, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[31mROLLBACK TRANSACTION[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[36mBEGIN deferred TRANSACTION[0m
----------------------------------------------------------------------------------
QueryLens::QueriesControllerTest: test_execute_rejects_SELECT_with_embedded_DELETE
----------------------------------------------------------------------------------
  [1m[35m (0.0ms)[0m  [1m[35mDROP TABLE IF EXISTS "users"[0m
  [1m[35m (0.0ms)[0m  [1m[35mCREATE TABLE "users" ("id" integer PRIMARY KEY AUTOINCREMENT NOT NULL, "name" varchar, "email" varchar, "created_at" datetime(6) NOT NULL, "updated_at" datetime(6) NOT NULL)[0m
  [1m[35m (0.0ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" varchar NOT NULL PRIMARY KEY)[0m
  [1m[35m (0.0ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" varchar NOT NULL PRIMARY KEY, "value" varchar, "created_at" datetime(6) NOT NULL, "updated_at" datetime(6) NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.0ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::InternalMetadata Create (0.0ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES ('environment', 'test', '2026-02-07 18:18:38.095120', '2026-02-07 18:18:38.095121') RETURNING "key"[0m
  [1m[35m (0.0ms)[0m  [1m[32mINSERT INTO users (name, email, created_at, updated_at) VALUES ('Alice', 'alice@example.com', datetime('now'), datetime('now'))[0m
  [1m[35m (0.0ms)[0m  [1m[32mINSERT INTO users (name, email, created_at, updated_at) VALUES ('Bob', 'bob@example.com', datetime('now'), datetime('now'))[0m
Started POST "/query_lens/execute" for 127.0.0.1 at 2026-02-07 13:18:38 -0500
Processing by QueryLens::QueriesController#execute as JSON
  Parameters: {"sql" => "SELECT 1; DELETE FROM users", "query" => {"sql" => "SELECT 1; DELETE FROM users"}}
Can't verify CSRF token authenticity.
Completed 422 Unprocessable Content in 0ms (Views: 0.0ms | ActiveRecord: 0.0ms (0 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[31mROLLBACK TRANSACTION[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[36mBEGIN deferred TRANSACTION[0m
--------------------------------------------------------------------------------
QueryLens::QueriesControllerTest: test_authentication_blocks_unauthorized_access
--------------------------------------------------------------------------------
  [1m[35m (0.0ms)[0m  [1m[35mDROP TABLE IF EXISTS "users"[0m
  [1m[35m (0.0ms)[0m  [1m[35mCREATE TABLE "users" ("id" integer PRIMARY KEY AUTOINCREMENT NOT NULL, "name" varchar, "email" varchar, "created_at" datetime(6) NOT NULL, "updated_at" datetime(6) NOT NULL)[0m
  [1m[35m (0.0ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" varchar NOT NULL PRIMARY KEY)[0m
  [1m[35m (0.0ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" varchar NOT NULL PRIMARY KEY, "value" varchar, "created_at" datetime(6) NOT NULL, "updated_at" datetime(6) NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.0ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::InternalMetadata Create (0.0ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES ('environment', 'test', '2026-02-07 18:18:38.096616', '2026-02-07 18:18:38.096617') RETURNING "key"[0m
  [1m[35m (0.0ms)[0m  [1m[32mINSERT INTO users (name, email, created_at, updated_at) VALUES ('Alice', 'alice@example.com', datetime('now'), datetime('now'))[0m
  [1m[35m (0.0ms)[0m  [1m[32mINSERT INTO users (name, email, created_at, updated_at) VALUES ('Bob', 'bob@example.com', datetime('now'), datetime('now'))[0m
Started GET "/query_lens/" for 127.0.0.1 at 2026-02-07 13:18:38 -0500
Processing by QueryLens::QueriesController#show as HTML
Filter chain halted as :authenticate! rendered or redirected
Completed 401 Unauthorized in 0ms (ActiveRecord: 0.0ms (0 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[31mROLLBACK TRANSACTION[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[36mBEGIN deferred TRANSACTION[0m
------------------------------------------------------------------------
QueryLens::QueriesControllerTest: test_execute_rejects_INSERT_statements
------------------------------------------------------------------------
  [1m[35m (0.0ms)[0m  [1m[35mDROP TABLE IF EXISTS "users"[0m
  [1m[35m (0.1ms)[0m  [1m[35mCREATE TABLE "users" ("id" integer PRIMARY KEY AUTOINCREMENT NOT NULL, "name" varchar, "email" varchar, "created_at" datetime(6) NOT NULL, "updated_at" datetime(6) NOT NULL)[0m
  [1m[35m (0.0ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" varchar NOT NULL PRIMARY KEY)[0m
  [1m[35m (0.0ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" varchar NOT NULL PRIMARY KEY, "value" varchar, "created_at" datetime(6) NOT NULL, "updated_at" datetime(6) NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.0ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::InternalMetadata Create (0.0ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES ('environment', 'test', '2026-02-07 18:18:38.098073', '2026-02-07 18:18:38.098073') RETURNING "key"[0m
  [1m[35m (0.0ms)[0m  [1m[32mINSERT INTO users (name, email, created_at, updated_at) VALUES ('Alice', 'alice@example.com', datetime('now'), datetime('now'))[0m
  [1m[35m (0.0ms)[0m  [1m[32mINSERT INTO users (name, email, created_at, updated_at) VALUES ('Bob', 'bob@example.com', datetime('now'), datetime('now'))[0m
Started POST "/query_lens/execute" for 127.0.0.1 at 2026-02-07 13:18:38 -0500
Processing by QueryLens::QueriesController#execute as JSON
  Parameters: {"sql" => "INSERT INTO users (name) VALUES ('hacker')", "query" => {"sql" => "INSERT INTO users (name) VALUES ('hacker')"}}
Can't verify CSRF token authenticity.
Completed 422 Unprocessable Content in 0ms (Views: 0.0ms | ActiveRecord: 0.0ms (0 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[31mROLLBACK TRANSACTION[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[36mBEGIN deferred TRANSACTION[0m
----------------------------------------------------------------------
QueryLens::SchemaIntrospectorTest: test_introspects_columns_with_types
----------------------------------------------------------------------
  [1m[35m (0.0ms)[0m  [1m[35mDROP TABLE IF EXISTS "users"[0m
  [1m[35m (0.0ms)[0m  [1m[35mCREATE TABLE "users" ("id" integer PRIMARY KEY AUTOINCREMENT NOT NULL, "name" varchar, "email" varchar, "created_at" datetime(6) NOT NULL, "updated_at" datetime(6) NOT NULL)[0m
  [1m[35m (0.0ms)[0m  [1m[35mDROP TABLE IF EXISTS "accounts"[0m
  [1m[35m (0.0ms)[0m  [1m[35mCREATE TABLE "accounts" ("id" integer PRIMARY KEY AUTOINCREMENT NOT NULL, "name" varchar, "plan" varchar, "created_at" datetime(6) NOT NULL, "updated_at" datetime(6) NOT NULL)[0m
  [1m[35m (0.0ms)[0m  [1m[35mDROP TABLE IF EXISTS "transactions"[0m
  [1m[35m (0.0ms)[0m  [1m[35mCREATE TABLE "transactions" ("id" integer PRIMARY KEY AUTOINCREMENT NOT NULL, "account_id" integer, "user_id" integer, "amount" decimal(10,2), "description" varchar, "created_at" datetime(6) NOT NULL, "updated_at" datetime(6) NOT NULL)[0m
  [1m[35m (0.0ms)[0m  [1m[35mCREATE INDEX "index_transactions_on_account_id" ON "transactions" ("account_id")[0m
  [1m[35m (0.0ms)[0m  [1m[35mCREATE INDEX "index_transactions_on_user_id" ON "transactions" ("user_id")[0m
  [1m[35m (0.0ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" varchar NOT NULL PRIMARY KEY)[0m
  [1m[35m (0.0ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" varchar NOT NULL PRIMARY KEY, "value" varchar, "created_at" datetime(6) NOT NULL, "updated_at" datetime(6) NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.0ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::InternalMetadata Create (0.0ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES ('environment', 'test', '2026-02-07 18:18:38.100496', '2026-02-07 18:18:38.100497') RETURNING "key"[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "accounts"[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "transactions"[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[31mROLLBACK TRANSACTION[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[36mBEGIN deferred TRANSACTION[0m
-------------------------------------------------------------
QueryLens::SchemaIntrospectorTest: test_generates_prompt_text
-------------------------------------------------------------
  [1m[35m (0.0ms)[0m  [1m[35mDROP TABLE IF EXISTS "users"[0m
  [1m[35m (0.1ms)[0m  [1m[35mCREATE TABLE "users" ("id" integer PRIMARY KEY AUTOINCREMENT NOT NULL, "name" varchar, "email" varchar, "created_at" datetime(6) NOT NULL, "updated_at" datetime(6) NOT NULL)[0m
  [1m[35m (0.0ms)[0m  [1m[35mDROP TABLE IF EXISTS "accounts"[0m
  [1m[35m (0.0ms)[0m  [1m[35mCREATE TABLE "accounts" ("id" integer PRIMARY KEY AUTOINCREMENT NOT NULL, "name" varchar, "plan" varchar, "created_at" datetime(6) NOT NULL, "updated_at" datetime(6) NOT NULL)[0m
  [1m[35m (0.0ms)[0m  [1m[35mDROP TABLE IF EXISTS "transactions"[0m
  [1m[35m (0.0ms)[0m  [1m[35mCREATE TABLE "transactions" ("id" integer PRIMARY KEY AUTOINCREMENT NOT NULL, "account_id" integer, "user_id" integer, "amount" decimal(10,2), "description" varchar, "created_at" datetime(6) NOT NULL, "updated_at" datetime(6) NOT NULL)[0m
  [1m[35m (0.0ms)[0m  [1m[35mCREATE INDEX "index_transactions_on_account_id" ON "transactions" ("account_id")[0m
  [1m[35m (0.0ms)[0m  [1m[35mCREATE INDEX "index_transactions_on_user_id" ON "transactions" ("user_id")[0m
  [1m[35m (0.0ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" varchar NOT NULL PRIMARY KEY)[0m
  [1m[35m (0.0ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" varchar NOT NULL PRIMARY KEY, "value" varchar, "created_at" datetime(6) NOT NULL, "updated_at" datetime(6) NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.0ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::InternalMetadata Create (0.0ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES ('environment', 'test', '2026-02-07 18:18:38.105561', '2026-02-07 18:18:38.105562') RETURNING "key"[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "accounts"[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "transactions"[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[31mROLLBACK TRANSACTION[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[36mBEGIN deferred TRANSACTION[0m
--------------------------------------------------------------------------------
QueryLens::SchemaIntrospectorTest: test_identifies_foreign_keys_from__id_columns
--------------------------------------------------------------------------------
  [1m[35m (0.0ms)[0m  [1m[35mDROP TABLE IF EXISTS "users"[0m
  [1m[35m (0.1ms)[0m  [1m[35mCREATE TABLE "users" ("id" integer PRIMARY KEY AUTOINCREMENT NOT NULL, "name" varchar, "email" varchar, "created_at" datetime(6) NOT NULL, "updated_at" datetime(6) NOT NULL)[0m
  [1m[35m (0.0ms)[0m  [1m[35mDROP TABLE IF EXISTS "accounts"[0m
  [1m[35m (0.0ms)[0m  [1m[35mCREATE TABLE "accounts" ("id" integer PRIMARY KEY AUTOINCREMENT NOT NULL, "name" varchar, "plan" varchar, "created_at" datetime(6) NOT NULL, "updated_at" datetime(6) NOT NULL)[0m
  [1m[35m (0.0ms)[0m  [1m[35mDROP TABLE IF EXISTS "transactions"[0m
  [1m[35m (0.0ms)[0m  [1m[35mCREATE TABLE "transactions" ("id" integer PRIMARY KEY AUTOINCREMENT NOT NULL, "account_id" integer, "user_id" integer, "amount" decimal(10,2), "description" varchar, "created_at" datetime(6) NOT NULL, "updated_at" datetime(6) NOT NULL)[0m
  [1m[35m (0.0ms)[0m  [1m[35mCREATE INDEX "index_transactions_on_account_id" ON "transactions" ("account_id")[0m
  [1m[35m (0.0ms)[0m  [1m[35mCREATE INDEX "index_transactions_on_user_id" ON "transactions" ("user_id")[0m
  [1m[35m (0.0ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" varchar NOT NULL PRIMARY KEY)[0m
  [1m[35m (0.0ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" varchar NOT NULL PRIMARY KEY, "value" varchar, "created_at" datetime(6) NOT NULL, "updated_at" datetime(6) NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.0ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::InternalMetadata Create (0.0ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES ('environment', 'test', '2026-02-07 18:18:38.109358', '2026-02-07 18:18:38.109358') RETURNING "key"[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "accounts"[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "transactions"[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[31mROLLBACK TRANSACTION[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[36mBEGIN deferred TRANSACTION[0m
-----------------------------------------------------------------------
QueryLens::SchemaIntrospectorTest: test_includes_approximate_row_counts
-----------------------------------------------------------------------
  [1m[35m (0.0ms)[0m  [1m[35mDROP TABLE IF EXISTS "users"[0m
  [1m[35m (0.1ms)[0m  [1m[35mCREATE TABLE "users" ("id" integer PRIMARY KEY AUTOINCREMENT NOT NULL, "name" varchar, "email" varchar, "created_at" datetime(6) NOT NULL, "updated_at" datetime(6) NOT NULL)[0m
  [1m[35m (0.0ms)[0m  [1m[35mDROP TABLE IF EXISTS "accounts"[0m
  [1m[35m (0.0ms)[0m  [1m[35mCREATE TABLE "accounts" ("id" integer PRIMARY KEY AUTOINCREMENT NOT NULL, "name" varchar, "plan" varchar, "created_at" datetime(6) NOT NULL, "updated_at" datetime(6) NOT NULL)[0m
  [1m[35m (0.0ms)[0m  [1m[35mDROP TABLE IF EXISTS "transactions"[0m
  [1m[35m (0.0ms)[0m  [1m[35mCREATE TABLE "transactions" ("id" integer PRIMARY KEY AUTOINCREMENT NOT NULL, "account_id" integer, "user_id" integer, "amount" decimal(10,2), "description" varchar, "created_at" datetime(6) NOT NULL, "updated_at" datetime(6) NOT NULL)[0m
  [1m[35m (0.0ms)[0m  [1m[35mCREATE INDEX "index_transactions_on_account_id" ON "transactions" ("account_id")[0m
  [1m[35m (0.0ms)[0m  [1m[35mCREATE INDEX "index_transactions_on_user_id" ON "transactions" ("user_id")[0m
  [1m[35m (0.0ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" varchar NOT NULL PRIMARY KEY)[0m
  [1m[35m (0.0ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" varchar NOT NULL PRIMARY KEY, "value" varchar, "created_at" datetime(6) NOT NULL, "updated_at" datetime(6) NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.0ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::InternalMetadata Create (0.0ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES ('environment', 'test', '2026-02-07 18:18:38.113880', '2026-02-07 18:18:38.113881') RETURNING "key"[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "accounts"[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "transactions"[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[31mROLLBACK TRANSACTION[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[36mBEGIN deferred TRANSACTION[0m
------------------------------------------------------------------------------
QueryLens::SchemaIntrospectorTest: test_respects_excluded_tables_configuration
------------------------------------------------------------------------------
  [1m[35m (0.0ms)[0m  [1m[35mDROP TABLE IF EXISTS "users"[0m
  [1m[35m (0.0ms)[0m  [1m[35mCREATE TABLE "users" ("id" integer PRIMARY KEY AUTOINCREMENT NOT NULL, "name" varchar, "email" varchar, "created_at" datetime(6) NOT NULL, "updated_at" datetime(6) NOT NULL)[0m
  [1m[35m (0.0ms)[0m  [1m[35mDROP TABLE IF EXISTS "accounts"[0m
  [1m[35m (0.0ms)[0m  [1m[35mCREATE TABLE "accounts" ("id" integer PRIMARY KEY AUTOINCREMENT NOT NULL, "name" varchar, "plan" varchar, "created_at" datetime(6) NOT NULL, "updated_at" datetime(6) NOT NULL)[0m
  [1m[35m (0.0ms)[0m  [1m[35mDROP TABLE IF EXISTS "transactions"[0m
  [1m[35m (0.0ms)[0m  [1m[35mCREATE TABLE "transactions" ("id" integer PRIMARY KEY AUTOINCREMENT NOT NULL, "account_id" integer, "user_id" integer, "amount" decimal(10,2), "description" varchar, "created_at" datetime(6) NOT NULL, "updated_at" datetime(6) NOT NULL)[0m
  [1m[35m (0.0ms)[0m  [1m[35mCREATE INDEX "index_transactions_on_account_id" ON "transactions" ("account_id")[0m
  [1m[35m (0.0ms)[0m  [1m[35mCREATE INDEX "index_transactions_on_user_id" ON "transactions" ("user_id")[0m
  [1m[35m (0.0ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" varchar NOT NULL PRIMARY KEY)[0m
  [1m[35m (0.0ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" varchar NOT NULL PRIMARY KEY, "value" varchar, "created_at" datetime(6) NOT NULL, "updated_at" datetime(6) NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.0ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::InternalMetadata Create (0.0ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES ('environment', 'test', '2026-02-07 18:18:38.117672', '2026-02-07 18:18:38.117672') RETURNING "key"[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "accounts"[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[31mROLLBACK TRANSACTION[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[36mBEGIN deferred TRANSACTION[0m
---------------------------------------------------------------------------
QueryLens::SchemaIntrospectorTest: test_introspects_all_non-excluded_tables
---------------------------------------------------------------------------
  [1m[35m (0.0ms)[0m  [1m[35mDROP TABLE IF EXISTS "users"[0m
  [1m[35m (0.0ms)[0m  [1m[35mCREATE TABLE "users" ("id" integer PRIMARY KEY AUTOINCREMENT NOT NULL, "name" varchar, "email" varchar, "created_at" datetime(6) NOT NULL, "updated_at" datetime(6) NOT NULL)[0m
  [1m[35m (0.0ms)[0m  [1m[35mDROP TABLE IF EXISTS "accounts"[0m
  [1m[35m (0.0ms)[0m  [1m[35mCREATE TABLE "accounts" ("id" integer PRIMARY KEY AUTOINCREMENT NOT NULL, "name" varchar, "plan" varchar, "created_at" datetime(6) NOT NULL, "updated_at" datetime(6) NOT NULL)[0m
  [1m[35m (0.0ms)[0m  [1m[35mDROP TABLE IF EXISTS "transactions"[0m
  [1m[35m (0.0ms)[0m  [1m[35mCREATE TABLE "transactions" ("id" integer PRIMARY KEY AUTOINCREMENT NOT NULL, "account_id" integer, "user_id" integer, "amount" decimal(10,2), "description" varchar, "created_at" datetime(6) NOT NULL, "updated_at" datetime(6) NOT NULL)[0m
  [1m[35m (0.0ms)[0m  [1m[35mCREATE INDEX "index_transactions_on_account_id" ON "transactions" ("account_id")[0m
  [1m[35m (0.0ms)[0m  [1m[35mCREATE INDEX "index_transactions_on_user_id" ON "transactions" ("user_id")[0m
  [1m[35m (0.0ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" varchar NOT NULL PRIMARY KEY)[0m
  [1m[35m (0.0ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" varchar NOT NULL PRIMARY KEY, "value" varchar, "created_at" datetime(6) NOT NULL, "updated_at" datetime(6) NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.0ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::InternalMetadata Create (0.0ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES ('environment', 'test', '2026-02-07 18:18:38.120515', '2026-02-07 18:18:38.120524') RETURNING "key"[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "accounts"[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "transactions"[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[31mROLLBACK TRANSACTION[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[36mBEGIN deferred TRANSACTION[0m
------------------------------------------------------------------
QueryLens::AiControllerTest: test_generate_returns_SQL_from_Claude
------------------------------------------------------------------
  [1m[35m (0.0ms)[0m  [1m[35mDROP TABLE IF EXISTS "users"[0m
  [1m[35m (0.0ms)[0m  [1m[35mCREATE TABLE "users" ("id" integer PRIMARY KEY AUTOINCREMENT NOT NULL, "name" varchar, "email" varchar, "created_at" datetime(6) NOT NULL, "updated_at" datetime(6) NOT NULL)[0m
  [1m[35m (0.0ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" varchar NOT NULL PRIMARY KEY)[0m
  [1m[35m (0.0ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" varchar NOT NULL PRIMARY KEY, "value" varchar, "created_at" datetime(6) NOT NULL, "updated_at" datetime(6) NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.0ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::InternalMetadata Create (0.0ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES ('environment', 'test', '2026-02-07 18:18:38.123947', '2026-02-07 18:18:38.123948') RETURNING "key"[0m
Started POST "/query_lens/generate" for 127.0.0.1 at 2026-02-07 13:18:38 -0500
Processing by QueryLens::AiController#generate as JSON
  Parameters: {"messages" => [{"role" => "user", "content" => "How many users?"}], "ai" => {"messages" => [{"role" => "user", "content" => "How many users?"}]}}
Can't verify CSRF token authenticity.
  [1m[35m (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
Completed 200 OK in 97ms (Views: 0.1ms | ActiveRecord: 0.3ms (1 query, 0 cached) | GC: 21.1ms)
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[31mROLLBACK TRANSACTION[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[36mBEGIN deferred TRANSACTION[0m
-----------------------------------------------------------------------
QueryLens::AiControllerTest: test_generate_returns_error_when_API_fails
-----------------------------------------------------------------------
  [1m[35m (0.1ms)[0m  [1m[35mDROP TABLE IF EXISTS "users"[0m
  [1m[35m (0.1ms)[0m  [1m[35mCREATE TABLE "users" ("id" integer PRIMARY KEY AUTOINCREMENT NOT NULL, "name" varchar, "email" varchar, "created_at" datetime(6) NOT NULL, "updated_at" datetime(6) NOT NULL)[0m
  [1m[35m (0.0ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" varchar NOT NULL PRIMARY KEY)[0m
  [1m[35m (0.0ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" varchar NOT NULL PRIMARY KEY, "value" varchar, "created_at" datetime(6) NOT NULL, "updated_at" datetime(6) NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.0ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::InternalMetadata Create (0.0ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES ('environment', 'test', '2026-02-07 18:18:38.231771', '2026-02-07 18:18:38.231772') RETURNING "key"[0m
Started POST "/query_lens/generate" for 127.0.0.1 at 2026-02-07 13:18:38 -0500
Processing by QueryLens::AiController#generate as JSON
  Parameters: {"messages" => [{"role" => "user", "content" => "test"}], "ai" => {"messages" => [{"role" => "user", "content" => "test"}]}}
Can't verify CSRF token authenticity.
  [1m[35m (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
Completed 422 Unprocessable Content in 483ms (Views: 0.3ms | ActiveRecord: 0.3ms (1 query, 0 cached) | GC: 5.9ms)
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK TRANSACTION[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[36mBEGIN deferred TRANSACTION[0m
---------------------------------------------------------------
QueryLens::SqlGeneratorTest: test_extracts_SQL_from_code_fences
---------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK TRANSACTION[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[36mBEGIN deferred TRANSACTION[0m
------------------------------------------------------------------------
QueryLens::SqlGeneratorTest: test_generates_SQL_from_Claude_API_response
------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[31mROLLBACK TRANSACTION[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[36mBEGIN deferred TRANSACTION[0m
-----------------------------------------------------------------------------
QueryLens::SqlGeneratorTest: test_raises_error_when_API_key_is_not_configured
-----------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[31mROLLBACK TRANSACTION[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[36mBEGIN deferred TRANSACTION[0m
---------------------------------------------------------------------------------
QueryLens::SqlGeneratorTest: test_returns_nil_sql_when_no_code_fences_in_response
---------------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[31mROLLBACK TRANSACTION[0m
